{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/rofid/.gemini/antigravity/scratch/SeTutor/src/lib/hooks/useAuthenticatedFetch.ts"],"sourcesContent":["/**\r\n * Hook for making authenticated API requests with Firebase JWT tokens\r\n * \r\n * This hook provides a fetch wrapper that automatically includes the\r\n * Firebase ID token in the Authorization header for secure API calls.\r\n */\r\n\r\nimport { useCallback } from 'react';\r\nimport { getFirebaseAuth } from '@/lib/firebase/config';\r\n\r\n/**\r\n * Custom hook that returns an authenticated fetch function\r\n * Automatically attaches the Firebase ID token to requests\r\n */\r\nexport function useAuthenticatedFetch() {\r\n  const authenticatedFetch = useCallback(async (\r\n    url: string,\r\n    options: RequestInit = {}\r\n  ): Promise<Response> => {\r\n    const auth = getFirebaseAuth();\r\n    const currentUser = auth.currentUser;\r\n    \r\n    if (!currentUser) {\r\n      throw new Error('User is not authenticated');\r\n    }\r\n    \r\n    // Get fresh ID token (Firebase handles caching and refresh)\r\n    const idToken = await currentUser.getIdToken();\r\n    \r\n    // Merge headers with Authorization\r\n    const headers = new Headers(options.headers);\r\n    headers.set('Authorization', `Bearer ${idToken}`);\r\n    \r\n    return fetch(url, {\r\n      ...options,\r\n      headers,\r\n    });\r\n  }, []);\r\n  \r\n  return { authenticatedFetch };\r\n}\r\n\r\n/**\r\n * Standalone function to get the current user's ID token\r\n * Useful for non-hook contexts\r\n */\r\nexport async function getIdToken(): Promise<string | null> {\r\n  const auth = getFirebaseAuth();\r\n  const currentUser = auth.currentUser;\r\n  \r\n  if (!currentUser) {\r\n    return null;\r\n  }\r\n  \r\n  return currentUser.getIdToken();\r\n}\r\n\r\n/**\r\n * Create authenticated fetch headers\r\n * Useful when you need to construct headers manually\r\n */\r\nexport async function createAuthHeaders(\r\n  additionalHeaders?: Record<string, string>\r\n): Promise<Headers> {\r\n  const headers = new Headers(additionalHeaders);\r\n  const token = await getIdToken();\r\n  \r\n  if (token) {\r\n    headers.set('Authorization', `Bearer ${token}`);\r\n  }\r\n  \r\n  return headers;\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAA;;;;;CAKC,GAED;AACA;;;AAMO,SAAS;IACd,MAAM,qBAAqB,IAAA,oNAAW,EAAC,OACrC,KACA,UAAuB,CAAC,CAAC;QAEzB,MAAM,OAAO,IAAA,mJAAe;QAC5B,MAAM,cAAc,KAAK,WAAW;QAEpC,IAAI,CAAC,aAAa;YAChB,MAAM,IAAI,MAAM;QAClB;QAEA,4DAA4D;QAC5D,MAAM,UAAU,MAAM,YAAY,UAAU;QAE5C,mCAAmC;QACnC,MAAM,UAAU,IAAI,QAAQ,QAAQ,OAAO;QAC3C,QAAQ,GAAG,CAAC,iBAAiB,CAAC,OAAO,EAAE,SAAS;QAEhD,OAAO,MAAM,KAAK;YAChB,GAAG,OAAO;YACV;QACF;IACF,GAAG,EAAE;IAEL,OAAO;QAAE;IAAmB;AAC9B;AAMO,eAAe;IACpB,MAAM,OAAO,IAAA,mJAAe;IAC5B,MAAM,cAAc,KAAK,WAAW;IAEpC,IAAI,CAAC,aAAa;QAChB,OAAO;IACT;IAEA,OAAO,YAAY,UAAU;AAC/B;AAMO,eAAe,kBACpB,iBAA0C;IAE1C,MAAM,UAAU,IAAI,QAAQ;IAC5B,MAAM,QAAQ,MAAM;IAEpB,IAAI,OAAO;QACT,QAAQ,GAAG,CAAC,iBAAiB,CAAC,OAAO,EAAE,OAAO;IAChD;IAEA,OAAO;AACT"}}]
}