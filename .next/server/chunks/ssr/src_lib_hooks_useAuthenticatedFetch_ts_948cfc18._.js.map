{"version":3,"sources":["../../../../src/lib/hooks/useAuthenticatedFetch.ts"],"sourcesContent":["/**\r\n * Hook for making authenticated API requests with Firebase JWT tokens\r\n * \r\n * This hook provides a fetch wrapper that automatically includes the\r\n * Firebase ID token in the Authorization header for secure API calls.\r\n */\r\n\r\nimport { useCallback } from 'react';\r\nimport { getFirebaseAuth } from '@/lib/firebase/config';\r\n\r\n/**\r\n * Custom hook that returns an authenticated fetch function\r\n * Automatically attaches the Firebase ID token to requests\r\n */\r\nexport function useAuthenticatedFetch() {\r\n  const authenticatedFetch = useCallback(async (\r\n    url: string,\r\n    options: RequestInit = {}\r\n  ): Promise<Response> => {\r\n    const auth = getFirebaseAuth();\r\n    const currentUser = auth.currentUser;\r\n    \r\n    if (!currentUser) {\r\n      throw new Error('User is not authenticated');\r\n    }\r\n    \r\n    // Get fresh ID token (Firebase handles caching and refresh)\r\n    const idToken = await currentUser.getIdToken();\r\n    \r\n    // Merge headers with Authorization\r\n    const headers = new Headers(options.headers);\r\n    headers.set('Authorization', `Bearer ${idToken}`);\r\n    \r\n    return fetch(url, {\r\n      ...options,\r\n      headers,\r\n    });\r\n  }, []);\r\n  \r\n  return { authenticatedFetch };\r\n}\r\n\r\n/**\r\n * Standalone function to get the current user's ID token\r\n * Useful for non-hook contexts\r\n */\r\nexport async function getIdToken(): Promise<string | null> {\r\n  const auth = getFirebaseAuth();\r\n  const currentUser = auth.currentUser;\r\n  \r\n  if (!currentUser) {\r\n    return null;\r\n  }\r\n  \r\n  return currentUser.getIdToken();\r\n}\r\n\r\n/**\r\n * Create authenticated fetch headers\r\n * Useful when you need to construct headers manually\r\n */\r\nexport async function createAuthHeaders(\r\n  additionalHeaders?: Record<string, string>\r\n): Promise<Headers> {\r\n  const headers = new Headers(additionalHeaders);\r\n  const token = await getIdToken();\r\n  \r\n  if (token) {\r\n    headers.set('Authorization', `Bearer ${token}`);\r\n  }\r\n  \r\n  return headers;\r\n}\r\n"],"names":[],"mappings":"sCAOA,IAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAMO,SAAS,IAyBd,MAAO,CAAE,mBAxBkB,CAAA,EAAA,EAAA,WAAA,AAAW,EAAC,MACrC,EACA,EAAuB,CAAC,CAAC,IAGzB,IAAM,EAAc,AADP,CAAA,EAAA,EAAA,eAAA,AAAe,IACH,WAAW,CAEpC,GAAI,CAAC,EACH,MAAU,AAAJ,KADU,CACA,6BAIlB,IAAM,EAAU,MAAM,EAAY,UAAU,GAGtC,EAAU,IAAI,QAAQ,EAAQ,OAAO,EAG3C,OAFA,EAAQ,GAAG,CAAC,gBAAiB,CAAC,OAAO,EAAE,EAAA,CAAS,EAEzC,MAAM,EAAK,CAChB,GAAG,CAAO,SACV,CACF,EACF,EAAG,EAAE,CAEuB,CAC9B,CAMO,eAAe,IAEpB,IAAM,EADO,AACO,CADP,EAAA,EAAA,eAAA,AAAe,IACH,WAAW,QAEpC,AAAK,EAIE,EAJH,AAIe,SAJD,CAIW,GAHpB,IAIX,CAMO,eAAe,EACpB,CAA0C,EAE1C,IAAM,EAAU,IAAI,QAAQ,GACtB,EAAQ,MAAM,IAMpB,OAJI,GACF,EAAQ,EADC,CACE,CAAC,gBAAiB,CAAC,OAAO,EAAE,EAAA,CAAO,EAGzC,CACT"}