module.exports=[36313,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.HooksClientContext},18341,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.ServerInsertedHtml},35112,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactDOM},56704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},20635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},9270,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.AppRouterContext},38783,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactServerDOMTurbopackClient},9292,a=>{"use strict";var b=a.i(72131),c=a.i(76725);function d(){return{authenticatedFetch:(0,b.useCallback)(async(a,b={})=>{let d=(0,c.getFirebaseAuth)().currentUser;if(!d)throw Error("User is not authenticated");let e=await d.getIdToken(),f=new Headers(b.headers);return f.set("Authorization",`Bearer ${e}`),fetch(a,{...b,headers:f})},[])}}async function e(){let a=(0,c.getFirebaseAuth)().currentUser;return a?a.getIdToken():null}async function f(a){let b=new Headers(a),c=await e();return c&&b.set("Authorization",`Bearer ${c}`),b}a.s(["createAuthHeaders",()=>f,"getIdToken",()=>e,"useAuthenticatedFetch",()=>d])},83347,a=>{"use strict";var b=a.i(72131),c=a.i(8098),d=a.i(9292);async function e(){let a=await (0,d.getIdToken)();if(!a)throw Error("Not authenticated");return{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}}function f(){let{user:a}=(0,c.useAuth)(),[d,f]=(0,b.useState)([]),[g,h]=(0,b.useState)(!1),[i,j]=(0,b.useState)(null),[k,l]=(0,b.useState)({currentPage:1,pageSize:20,totalItems:0,totalPages:0}),m=(0,b.useCallback)(a=>{l(b=>({...b,currentPage:a}))},[]),n=(0,b.useCallback)(a=>{l(b=>({...b,pageSize:a,currentPage:1}))},[]),o=(0,b.useCallback)(async b=>{if(a?.uid){h(!0),j(null);try{let a=await e(),c=new URLSearchParams;void 0!==b&&c.append("parentId",null===b?"null":b);let d=await fetch(`/api/folders?${c}`,{headers:a}),g=await d.json();if(!d.ok)throw Error(g.error||"Failed to fetch folders");f(g.folders),l(a=>({...a,totalItems:g.folders.length,totalPages:1,currentPage:1}))}catch(a){j(a instanceof Error?a.message:"Failed to fetch folders")}finally{h(!1)}}},[a?.uid]),p=(0,b.useCallback)(async(b,c,d)=>{if(!a?.uid)return;let g=d??k.pageSize,i=c??k.currentPage;h(!0),j(null);try{let a=await e(),c=new URLSearchParams({page:i.toString(),pageSize:g.toString()});void 0!==b&&c.append("parentId",null===b?"null":b);let d=await fetch(`/api/folders?${c}`,{headers:a}),h=await d.json();if(!d.ok)throw Error(h.error||"Failed to fetch folders");f(h.folders),l({currentPage:i,pageSize:g,totalItems:h.total,totalPages:Math.ceil(h.total/g)})}catch(a){j(a instanceof Error?a.message:"Failed to fetch folders")}finally{h(!1)}},[a?.uid,k.pageSize,k.currentPage]),q=(0,b.useCallback)(async b=>{if(!a?.uid)return[];try{let a=await e(),c=await fetch(`/api/folders/${b}/path`,{headers:a}),d=await c.json();if(!c.ok)throw Error(d.error||"Failed to fetch folder path");return d.path}catch(a){return j(a instanceof Error?a.message:"Failed to fetch folder path"),[]}},[a?.uid]),r=(0,b.useCallback)(async(b,c)=>{if(!a?.uid)return null;h(!0),j(null);try{let a=await e(),d=await fetch("/api/folders",{method:"POST",headers:a,body:JSON.stringify({name:b,parentId:c})}),g=await d.json();if(!d.ok)throw Error(g.error||"Failed to create folder");return f(a=>[...a,g.folder]),g.folder}catch(a){return j(a instanceof Error?a.message:"Failed to create folder"),null}finally{h(!1)}},[a?.uid]),s=(0,b.useCallback)(async(b,c)=>{if(!a?.uid)return null;h(!0),j(null);try{let a=await e(),d=await fetch(`/api/folders/${b}`,{method:"PUT",headers:a,body:JSON.stringify({name:c})}),g=await d.json();if(!d.ok)throw Error(g.error||"Failed to rename folder");return f(a=>a.map(a=>a.id===b?g.folder:a)),g.folder}catch(a){return j(a instanceof Error?a.message:"Failed to rename folder"),null}finally{h(!1)}},[a?.uid]),t=(0,b.useCallback)(async b=>{if(!a?.uid)return!1;h(!0),j(null);try{let a=await e(),c=await fetch(`/api/folders/${b}`,{method:"DELETE",headers:a}),d=await c.json();if(!c.ok)throw Error(d.error||"Failed to delete folder");return f(a=>a.filter(a=>a.id!==b)),!0}catch(a){return j(a instanceof Error?a.message:"Failed to delete folder"),!1}finally{h(!1)}},[a?.uid]),u=(0,b.useCallback)(async(b,c)=>{if(!a?.uid)return null;h(!0),j(null);try{let a=await e(),d=await fetch(`/api/folders/${b}/move`,{method:"POST",headers:a,body:JSON.stringify({newParentId:c})}),f=await d.json();if(!d.ok)throw Error(f.error||"Failed to move folder");return await o(),f.folder}catch(a){return j(a instanceof Error?a.message:"Failed to move folder"),null}finally{h(!1)}},[a?.uid,o]);return{folders:d,loading:g,error:i,pagination:k,fetchFolders:o,fetchFoldersPaginated:p,fetchFolderPath:q,createFolder:r,renameFolder:s,deleteFolder:t,moveFolder:u,setPage:m,setPageSize:n}}a.s(["useFolders",()=>f])},89789,a=>{"use strict";var b=a.i(72131),c=a.i(8098),d=a.i(9292);async function e(){let a=await (0,d.getIdToken)();if(!a)throw Error("Not authenticated");return{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}}function f(){let{user:a}=(0,c.useAuth)(),[f,g]=(0,b.useState)([]),[h,i]=(0,b.useState)(!1),[j,k]=(0,b.useState)(null),[l,m]=(0,b.useState)(new Map),[n,o]=(0,b.useState)({currentPage:1,pageSize:20,totalItems:0,totalPages:0}),p=(0,b.useCallback)(()=>k(null),[]),q=(0,b.useCallback)(a=>{o(b=>({...b,currentPage:a}))},[]),r=(0,b.useCallback)(a=>{o(b=>({...b,pageSize:a,currentPage:1}))},[]),s=(0,b.useCallback)(async b=>{if(a){i(!0),k(null);try{let a=await e(),c=new URLSearchParams;void 0!==b&&c.set("folderId",null===b?"null":b);let d=await fetch(`/api/documents?${c}`,{headers:a}),f=await d.json();if(!d.ok)throw Error(f.error||"Failed to fetch documents");g(f.documents),o(a=>({...a,totalItems:f.documents.length,totalPages:1,currentPage:1}))}catch(a){k(a instanceof Error?a.message:"Failed to fetch documents")}finally{i(!1)}}},[a]),t=(0,b.useCallback)(async(b,c,d)=>{if(!a)return;let f=d??n.pageSize,h=c??n.currentPage;i(!0),k(null);try{let a=await e(),c=new URLSearchParams({page:h.toString(),pageSize:f.toString()});void 0!==b&&c.set("folderId",null===b?"null":b);let d=await fetch(`/api/documents?${c}`,{headers:a}),i=await d.json();if(!d.ok)throw Error(i.error||"Failed to fetch documents");g(i.documents),o({currentPage:h,pageSize:f,totalItems:i.total,totalPages:Math.ceil(i.total/f)})}catch(a){k(a instanceof Error?a.message:"Failed to fetch documents")}finally{i(!1)}},[a,n.pageSize,n.currentPage]),u=(0,b.useCallback)(async b=>{if(a){i(!0),k(null);try{let a=await e(),c=new URLSearchParams({search:b}),d=await fetch(`/api/documents?${c}`,{headers:a}),f=await d.json();if(!d.ok)throw Error(f.error||"Failed to search documents");g(f.documents)}catch(a){k(a instanceof Error?a.message:"Failed to search documents")}finally{i(!1)}}},[a]),v=(0,b.useCallback)((a,b)=>{m(c=>{let d=new Map(c),e=d.get(a)||{fileName:a,progress:0,status:"pending"};return d.set(a,{...e,...b}),d})},[]),w=(0,b.useCallback)(async(b,c)=>{if(!a)return null;let e=new AbortController;v(b.name,{status:"uploading",progress:0,abortController:e});try{let a=await (0,d.getIdToken)();if(!a)throw Error("Not authenticated");let f=new FormData;f.append("file",b),c&&f.append("folderId",c);let h=await new Promise((c,d)=>{let g=new XMLHttpRequest;g.upload.addEventListener("progress",a=>{if(a.lengthComputable){let c=Math.round(a.loaded/a.total*100);v(b.name,{progress:c})}}),g.addEventListener("load",()=>{if(g.status>=200&&g.status<300){let a=JSON.parse(g.responseText);c(a.document)}else try{let a=JSON.parse(g.responseText);d(Error(a.error||"Upload failed"))}catch{d(Error("Upload failed"))}}),g.addEventListener("error",()=>{d(Error("Network error during upload"))}),g.addEventListener("abort",()=>{d(Error("Upload cancelled"))}),e.signal.addEventListener("abort",()=>{g.abort()}),g.open("POST","/api/documents/upload"),g.setRequestHeader("Authorization",`Bearer ${a}`),g.send(f)});return v(b.name,{status:"completed",progress:100}),g(a=>[h,...a]),h}catch(d){let a=d instanceof Error?d.message:"Upload failed",c="Upload cancelled"===a;return v(b.name,{status:c?"cancelled":"error",error:a}),c||k(a),null}},[a,v]),x=(0,b.useCallback)(async(a,b)=>{for(let c of(a.forEach(a=>{v(a.name,{status:"pending",progress:0})}),a)){let a=l.get(c.name);a?.status!=="cancelled"&&await w(c,b)}},[w,l,v]),y=(0,b.useCallback)(a=>{let b=l.get(a);b?.abortController&&b.abortController.abort(),v(a,{status:"cancelled"})},[l,v]),z=(0,b.useCallback)(async b=>{if(!a)return!1;try{let a=await e(),c=await fetch(`/api/documents/${b}`,{method:"DELETE",headers:a});if(!c.ok){let a=await c.json();throw Error(a.error||"Failed to delete document")}return g(a=>a.filter(a=>a.id!==b)),!0}catch(a){return k(a instanceof Error?a.message:"Failed to delete document"),!1}},[a]);return{documents:f,loading:h,error:j,uploadProgress:l,pagination:n,fetchDocuments:s,fetchDocumentsPaginated:t,searchDocuments:u,uploadDocument:w,uploadMultipleDocuments:x,cancelUpload:y,deleteDocument:z,moveDocument:(0,b.useCallback)(async(b,c)=>{if(!a)return null;try{let a=await e(),d=await fetch(`/api/documents/${b}`,{method:"PATCH",headers:a,body:JSON.stringify({folderId:c})}),f=await d.json();if(!d.ok)throw Error(f.error||"Failed to move document");return g(a=>a.map(a=>a.id===b?f.document:a)),f.document}catch(a){return k(a instanceof Error?a.message:"Failed to move document"),null}},[a]),renameDocument:(0,b.useCallback)(async(b,c)=>{if(!a)return null;try{let a=await e(),d=await fetch(`/api/documents/${b}`,{method:"PATCH",headers:a,body:JSON.stringify({name:c})}),f=await d.json();if(!d.ok)throw Error(f.error||"Failed to rename document");return g(a=>a.map(a=>a.id===b?f.document:a)),f.document}catch(a){return k(a instanceof Error?a.message:"Failed to rename document"),null}},[a]),clearError:p,setPage:q,setPageSize:r}}a.s(["useDocuments",()=>f])},81531,(a,b,c)=>{b.exports=a.x("@aws-sdk/client-s3-ecbef8e33fd0b8f0",()=>require("@aws-sdk/client-s3-ecbef8e33fd0b8f0"))},21422,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(27520);a.i(78122);var f=a.i(27058),g=a.i(66023),h=a.i(89789),i=a.i(83347),j=a.i(18604);function k(){let a=(0,d.useRouter)(),k=(0,d.useSearchParams)().get("folderId"),[l,m]=(0,c.useState)(k),[n,o]=(0,c.useState)(null),[p,q]=(0,c.useState)(!1),{uploadProgress:r,uploadMultipleDocuments:s,cancelUpload:t,error:u}=(0,h.useDocuments)(),{folders:v,fetchFolders:w}=(0,i.useFolders)(),x=(0,j.useToast)();(0,c.useEffect)(()=>{w()},[w]),(0,c.useEffect)(()=>{l&&v.length>0?o(v.find(a=>a.id===l)||null):o(null)},[l,v]);let y=(0,c.useCallback)(async a=>{await s(a,l);let b=Array.from(r.values()).filter(a=>"completed"===a.status).length,c=Array.from(r.values()).filter(a=>"error"===a.status).length;b>0&&0===c?x.success(`${a.length} file${a.length>1?"s":""} uploaded successfully`):c>0&&x.warning(`${b} uploaded, ${c} failed`)},[s,l,r,x]),z=(0,c.useCallback)(a=>{m(a?.id||null),o(a),q(!1)},[]),A=Array.from(r.values()).filter(a=>"completed"===a.status).length;return(0,b.jsx)(e.DashboardLayout,{children:(0,b.jsxs)("div",{className:"mx-auto max-w-3xl px-4 py-8 sm:px-6 lg:px-8",children:[(0,b.jsxs)("div",{className:"mb-8",children:[(0,b.jsxs)("button",{onClick:()=>a.back(),className:"mb-4 flex items-center gap-2 text-sm text-gray-600 hover:text-gray-900",children:[(0,b.jsx)("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back"]}),(0,b.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Upload Files"}),(0,b.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Upload PDF documents to your library. Files will be stored securely."})]}),(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Upload to folder"}),(0,b.jsxs)("button",{onClick:()=>q(!0),className:"flex w-full items-center justify-between rounded-lg border border-gray-300 bg-white px-4 py-3 text-left hover:bg-gray-50",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),(0,b.jsx)("span",{className:"text-gray-900",children:n?n.name:"My Files (Root)"})]}),(0,b.jsx)("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),n&&(0,b.jsxs)("p",{className:"mt-1 text-xs text-gray-500",children:["Path: ",n.path]})]}),u&&(0,b.jsx)("div",{className:"mb-6 rounded-lg bg-red-50 p-4 text-sm text-red-600",children:u}),(0,b.jsx)(f.FileUpload,{onUpload:y,uploadProgress:r,onCancelUpload:t,folderId:l}),A>0&&(0,b.jsxs)("div",{className:"mt-6 rounded-lg bg-green-50 p-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("svg",{className:"h-5 w-5 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,b.jsxs)("p",{className:"text-sm font-medium text-green-800",children:[A," file",A>1?"s":""," uploaded successfully"]})]}),(0,b.jsx)("div",{className:"mt-3",children:(0,b.jsx)("button",{onClick:()=>a.push(l?`/dashboard/files?folderId=${l}`:"/dashboard/files"),className:"text-sm font-medium text-green-700 hover:text-green-800",children:"View files â†’"})})]}),p&&(0,b.jsx)(g.FolderPickerModal,{folders:v,selectedFolderId:l,onSelect:z,onClose:()=>q(!1),allowRoot:!0})]})})}function l(){return(0,b.jsx)(c.Suspense,{fallback:(0,b.jsx)(e.DashboardLayout,{children:(0,b.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,b.jsx)("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-blue-600 border-t-transparent"})})}),children:(0,b.jsx)(k,{})})}a.s(["default",()=>l])},30560,a=>{a.v(a=>Promise.resolve().then(()=>a(9292)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__4daa6c70._.js.map