{"version":3,"sources":["../../../../src/components/ui/Skeleton.tsx","../../../../src/lib/hooks/useAuthenticatedFetch.ts","../../../../src/lib/hooks/useFolders.ts","../../../../src/lib/hooks/useDocuments.ts"],"sourcesContent":["\"use client\";\r\n\r\nimport { memo } from 'react';\r\n\r\ninterface SkeletonProps {\r\n  className?: string;\r\n  variant?: 'text' | 'circular' | 'rectangular';\r\n  width?: string | number;\r\n  height?: string | number;\r\n  animation?: 'pulse' | 'wave' | 'none';\r\n}\r\n\r\n/**\r\n * Skeleton loading component for smooth loading states\r\n * Requirements: 12.5 - Skeleton screens for smooth user experience\r\n */\r\nexport const Skeleton = memo(function Skeleton({\r\n  className = '',\r\n  variant = 'rectangular',\r\n  width,\r\n  height,\r\n  animation = 'pulse',\r\n}: SkeletonProps) {\r\n  const baseClasses = 'bg-gray-200';\r\n  \r\n  const variantClasses = {\r\n    text: 'rounded',\r\n    circular: 'rounded-full',\r\n    rectangular: 'rounded-lg',\r\n  };\r\n\r\n  const animationClasses = {\r\n    pulse: 'animate-pulse',\r\n    wave: 'animate-shimmer',\r\n    none: '',\r\n  };\r\n\r\n  const style: React.CSSProperties = {};\r\n  if (width) style.width = typeof width === 'number' ? `${width}px` : width;\r\n  if (height) style.height = typeof height === 'number' ? `${height}px` : height;\r\n\r\n  return (\r\n    <div\r\n      className={`${baseClasses} ${variantClasses[variant]} ${animationClasses[animation]} ${className}`}\r\n      style={style}\r\n      aria-hidden=\"true\"\r\n    />\r\n  );\r\n});\r\n\r\n/**\r\n * Skeleton for a card component\r\n */\r\nexport const CardSkeleton = memo(function CardSkeleton() {\r\n  return (\r\n    <div className=\"rounded-lg border border-gray-200 bg-white p-6 shadow-sm\">\r\n      <div className=\"flex items-center gap-4\">\r\n        <Skeleton variant=\"circular\" width={48} height={48} />\r\n        <div className=\"flex-1 space-y-2\">\r\n          <Skeleton height={16} width=\"60%\" />\r\n          <Skeleton height={12} width=\"40%\" />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\n/**\r\n * Skeleton for a stat card\r\n */\r\nexport const StatCardSkeleton = memo(function StatCardSkeleton() {\r\n  return (\r\n    <div className=\"rounded-lg bg-white p-6 shadow-sm\">\r\n      <div className=\"flex items-center gap-4\">\r\n        <Skeleton variant=\"rectangular\" width={48} height={48} className=\"rounded-lg\" />\r\n        <div className=\"space-y-2\">\r\n          <Skeleton height={14} width={60} />\r\n          <Skeleton height={24} width={40} />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\n/**\r\n * Skeleton for a document item in list view\r\n */\r\nexport const DocumentListItemSkeleton = memo(function DocumentListItemSkeleton() {\r\n  return (\r\n    <tr>\r\n      <td className=\"whitespace-nowrap px-6 py-4\">\r\n        <div className=\"flex items-center gap-3\">\r\n          <Skeleton variant=\"rectangular\" width={32} height={32} className=\"rounded-lg\" />\r\n          <div className=\"space-y-1\">\r\n            <Skeleton height={14} width={180} />\r\n            <Skeleton height={10} width={120} />\r\n          </div>\r\n        </div>\r\n      </td>\r\n      <td className=\"hidden whitespace-nowrap px-6 py-4 sm:table-cell\">\r\n        <Skeleton height={14} width={60} />\r\n      </td>\r\n      <td className=\"hidden whitespace-nowrap px-6 py-4 md:table-cell\">\r\n        <Skeleton height={14} width={80} />\r\n      </td>\r\n      <td className=\"whitespace-nowrap px-6 py-4 text-right\">\r\n        <div className=\"flex items-center justify-end gap-2\">\r\n          <Skeleton variant=\"circular\" width={28} height={28} />\r\n          <Skeleton variant=\"circular\" width={28} height={28} />\r\n          <Skeleton variant=\"circular\" width={28} height={28} />\r\n        </div>\r\n      </td>\r\n    </tr>\r\n  );\r\n});\r\n\r\n/**\r\n * Skeleton for a document item in grid view\r\n */\r\nexport const DocumentGridItemSkeleton = memo(function DocumentGridItemSkeleton() {\r\n  return (\r\n    <div className=\"rounded-lg border border-gray-200 bg-white p-4 shadow-sm\">\r\n      <Skeleton height={96} className=\"mb-3 w-full rounded-lg\" />\r\n      <Skeleton height={14} width=\"80%\" className=\"mb-2\" />\r\n      <Skeleton height={10} width=\"60%\" />\r\n    </div>\r\n  );\r\n});\r\n\r\n/**\r\n * Skeleton for a folder item\r\n */\r\nexport const FolderItemSkeleton = memo(function FolderItemSkeleton() {\r\n  return (\r\n    <div className=\"flex items-center gap-3 rounded-lg border border-gray-200 bg-white p-4\">\r\n      <Skeleton variant=\"rectangular\" width={48} height={48} className=\"rounded-lg\" />\r\n      <div className=\"flex-1 space-y-1\">\r\n        <Skeleton height={14} width=\"70%\" />\r\n        <Skeleton height={10} width=\"50%\" />\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\n/**\r\n * Skeleton for recent documents section\r\n */\r\nexport const RecentDocumentsSkeleton = memo(function RecentDocumentsSkeleton() {\r\n  return (\r\n    <div className=\"rounded-lg bg-white p-6 shadow-sm\">\r\n      <Skeleton height={20} width={140} className=\"mb-4\" />\r\n      <div className=\"space-y-3\">\r\n        {[...Array(3)].map((_, i) => (\r\n          <div key={i} className=\"flex items-center gap-3\">\r\n            <Skeleton variant=\"rectangular\" width={40} height={40} className=\"rounded-lg\" />\r\n            <div className=\"flex-1 space-y-2\">\r\n              <Skeleton height={14} width=\"75%\" />\r\n              <Skeleton height={10} width=\"50%\" />\r\n            </div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\n/**\r\n * Skeleton for document list\r\n */\r\nexport const DocumentListSkeleton = memo(function DocumentListSkeleton({ count = 5 }: { count?: number }) {\r\n  return (\r\n    <div className=\"overflow-hidden rounded-lg border border-gray-200 bg-white\">\r\n      <table className=\"min-w-full divide-y divide-gray-200\">\r\n        <thead className=\"bg-gray-50\">\r\n          <tr>\r\n            <th className=\"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500\">\r\n              Name\r\n            </th>\r\n            <th className=\"hidden px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500 sm:table-cell\">\r\n              Size\r\n            </th>\r\n            <th className=\"hidden px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500 md:table-cell\">\r\n              Uploaded\r\n            </th>\r\n            <th className=\"px-6 py-3 text-right text-xs font-medium uppercase tracking-wider text-gray-500\">\r\n              Actions\r\n            </th>\r\n          </tr>\r\n        </thead>\r\n        <tbody className=\"divide-y divide-gray-200\">\r\n          {[...Array(count)].map((_, i) => (\r\n            <DocumentListItemSkeleton key={i} />\r\n          ))}\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n  );\r\n});\r\n\r\n/**\r\n * Skeleton for document grid\r\n */\r\nexport const DocumentGridSkeleton = memo(function DocumentGridSkeleton({ count = 8 }: { count?: number }) {\r\n  return (\r\n    <div className=\"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4\">\r\n      {[...Array(count)].map((_, i) => (\r\n        <DocumentGridItemSkeleton key={i} />\r\n      ))}\r\n    </div>\r\n  );\r\n});\r\n\r\n/**\r\n * Skeleton for folder grid\r\n */\r\nexport const FolderGridSkeleton = memo(function FolderGridSkeleton({ count = 6 }: { count?: number }) {\r\n  return (\r\n    <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-3\">\r\n      {[...Array(count)].map((_, i) => (\r\n        <FolderItemSkeleton key={i} />\r\n      ))}\r\n    </div>\r\n  );\r\n});\r\n","/**\r\n * Hook for making authenticated API requests with Firebase JWT tokens\r\n * \r\n * This hook provides a fetch wrapper that automatically includes the\r\n * Firebase ID token in the Authorization header for secure API calls.\r\n */\r\n\r\nimport { useCallback } from 'react';\r\nimport { getFirebaseAuth } from '@/lib/firebase/config';\r\n\r\n/**\r\n * Custom hook that returns an authenticated fetch function\r\n * Automatically attaches the Firebase ID token to requests\r\n */\r\nexport function useAuthenticatedFetch() {\r\n  const authenticatedFetch = useCallback(async (\r\n    url: string,\r\n    options: RequestInit = {}\r\n  ): Promise<Response> => {\r\n    const auth = getFirebaseAuth();\r\n    const currentUser = auth.currentUser;\r\n    \r\n    if (!currentUser) {\r\n      throw new Error('User is not authenticated');\r\n    }\r\n    \r\n    // Get fresh ID token (Firebase handles caching and refresh)\r\n    const idToken = await currentUser.getIdToken();\r\n    \r\n    // Merge headers with Authorization\r\n    const headers = new Headers(options.headers);\r\n    headers.set('Authorization', `Bearer ${idToken}`);\r\n    \r\n    return fetch(url, {\r\n      ...options,\r\n      headers,\r\n    });\r\n  }, []);\r\n  \r\n  return { authenticatedFetch };\r\n}\r\n\r\n/**\r\n * Standalone function to get the current user's ID token\r\n * Useful for non-hook contexts\r\n */\r\nexport async function getIdToken(): Promise<string | null> {\r\n  const auth = getFirebaseAuth();\r\n  const currentUser = auth.currentUser;\r\n  \r\n  if (!currentUser) {\r\n    return null;\r\n  }\r\n  \r\n  return currentUser.getIdToken();\r\n}\r\n\r\n/**\r\n * Create authenticated fetch headers\r\n * Useful when you need to construct headers manually\r\n */\r\nexport async function createAuthHeaders(\r\n  additionalHeaders?: Record<string, string>\r\n): Promise<Headers> {\r\n  const headers = new Headers(additionalHeaders);\r\n  const token = await getIdToken();\r\n  \r\n  if (token) {\r\n    headers.set('Authorization', `Bearer ${token}`);\r\n  }\r\n  \r\n  return headers;\r\n}\r\n","\"use client\";\r\n\r\nimport { useState, useCallback } from 'react';\r\nimport { useAuth } from '@/lib/firebase/AuthContext';\r\nimport { getIdToken } from './useAuthenticatedFetch';\r\n\r\nexport interface Folder {\r\n  id: string;\r\n  name: string;\r\n  parent_id: string | null;\r\n  user_id: string;\r\n  path: string;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface PaginationState {\r\n  currentPage: number;\r\n  pageSize: number;\r\n  totalItems: number;\r\n  totalPages: number;\r\n}\r\n\r\ninterface UseFoldersReturn {\r\n  folders: Folder[];\r\n  loading: boolean;\r\n  error: string | null;\r\n  pagination: PaginationState;\r\n  fetchFolders: (parentId?: string | null) => Promise<void>;\r\n  fetchFoldersPaginated: (parentId?: string | null, page?: number, pageSize?: number) => Promise<void>;\r\n  fetchFolderPath: (folderId: string) => Promise<Folder[]>;\r\n  createFolder: (name: string, parentId?: string | null) => Promise<Folder | null>;\r\n  renameFolder: (id: string, name: string) => Promise<Folder | null>;\r\n  deleteFolder: (id: string) => Promise<boolean>;\r\n  moveFolder: (id: string, newParentId: string | null) => Promise<Folder | null>;\r\n  setPage: (page: number) => void;\r\n  setPageSize: (pageSize: number) => void;\r\n}\r\n\r\n/**\r\n * Helper to create authenticated headers with JWT token\r\n */\r\nasync function getAuthHeaders(): Promise<HeadersInit> {\r\n  const token = await getIdToken();\r\n  if (!token) {\r\n    throw new Error('Not authenticated');\r\n  }\r\n  return {\r\n    'Authorization': `Bearer ${token}`,\r\n    'Content-Type': 'application/json',\r\n  };\r\n}\r\n\r\nexport function useFolders(): UseFoldersReturn {\r\n  const { user } = useAuth();\r\n  const [folders, setFolders] = useState<Folder[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [pagination, setPagination] = useState<PaginationState>({\r\n    currentPage: 1,\r\n    pageSize: 20,\r\n    totalItems: 0,\r\n    totalPages: 0,\r\n  });\r\n\r\n  const setPage = useCallback((page: number) => {\r\n    setPagination(prev => ({ ...prev, currentPage: page }));\r\n  }, []);\r\n\r\n  const setPageSize = useCallback((pageSize: number) => {\r\n    setPagination(prev => ({ ...prev, pageSize, currentPage: 1 }));\r\n  }, []);\r\n\r\n  const fetchFolders = useCallback(async (parentId?: string | null) => {\r\n    if (!user?.uid) return;\r\n    \r\n    setLoading(true);\r\n    setError(null);\r\n    \r\n    try {\r\n      const headers = await getAuthHeaders();\r\n      const params = new URLSearchParams();\r\n      if (parentId !== undefined) {\r\n        params.append('parentId', parentId === null ? 'null' : parentId);\r\n      }\r\n      \r\n      const response = await fetch(`/api/folders?${params}`, { headers });\r\n      const data = await response.json();\r\n      \r\n      if (!response.ok) {\r\n        throw new Error(data.error || 'Failed to fetch folders');\r\n      }\r\n      \r\n      setFolders(data.folders);\r\n      setPagination(prev => ({\r\n        ...prev,\r\n        totalItems: data.folders.length,\r\n        totalPages: 1,\r\n        currentPage: 1,\r\n      }));\r\n    } catch (err) {\r\n      const message = err instanceof Error ? err.message : 'Failed to fetch folders';\r\n      setError(message);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [user?.uid]);\r\n\r\n  const fetchFoldersPaginated = useCallback(async (\r\n    parentId?: string | null,\r\n    page?: number,\r\n    pageSize?: number\r\n  ) => {\r\n    if (!user?.uid) return;\r\n    \r\n    const currentPageSize = pageSize ?? pagination.pageSize;\r\n    const currentPage = page ?? pagination.currentPage;\r\n    \r\n    setLoading(true);\r\n    setError(null);\r\n    \r\n    try {\r\n      const headers = await getAuthHeaders();\r\n      const params = new URLSearchParams({ \r\n        page: currentPage.toString(),\r\n        pageSize: currentPageSize.toString(),\r\n      });\r\n      if (parentId !== undefined) {\r\n        params.append('parentId', parentId === null ? 'null' : parentId);\r\n      }\r\n      \r\n      const response = await fetch(`/api/folders?${params}`, { headers });\r\n      const data = await response.json();\r\n      \r\n      if (!response.ok) {\r\n        throw new Error(data.error || 'Failed to fetch folders');\r\n      }\r\n      \r\n      setFolders(data.folders);\r\n      setPagination({\r\n        currentPage,\r\n        pageSize: currentPageSize,\r\n        totalItems: data.total,\r\n        totalPages: Math.ceil(data.total / currentPageSize),\r\n      });\r\n    } catch (err) {\r\n      const message = err instanceof Error ? err.message : 'Failed to fetch folders';\r\n      setError(message);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [user?.uid, pagination.pageSize, pagination.currentPage]);\r\n\r\n  const fetchFolderPath = useCallback(async (folderId: string): Promise<Folder[]> => {\r\n    if (!user?.uid) return [];\r\n    \r\n    try {\r\n      const headers = await getAuthHeaders();\r\n      const response = await fetch(`/api/folders/${folderId}/path`, { headers });\r\n      const data = await response.json();\r\n      \r\n      if (!response.ok) {\r\n        throw new Error(data.error || 'Failed to fetch folder path');\r\n      }\r\n      \r\n      return data.path;\r\n    } catch (err) {\r\n      const message = err instanceof Error ? err.message : 'Failed to fetch folder path';\r\n      setError(message);\r\n      return [];\r\n    }\r\n  }, [user?.uid]);\r\n\r\n  const createFolder = useCallback(async (name: string, parentId?: string | null): Promise<Folder | null> => {\r\n    if (!user?.uid) return null;\r\n    \r\n    setLoading(true);\r\n    setError(null);\r\n    \r\n    try {\r\n      const headers = await getAuthHeaders();\r\n      const response = await fetch('/api/folders', {\r\n        method: 'POST',\r\n        headers,\r\n        body: JSON.stringify({ name, parentId })\r\n      });\r\n      \r\n      const data = await response.json();\r\n      \r\n      if (!response.ok) {\r\n        throw new Error(data.error || 'Failed to create folder');\r\n      }\r\n      \r\n      setFolders(prev => [...prev, data.folder]);\r\n      return data.folder;\r\n    } catch (err) {\r\n      const message = err instanceof Error ? err.message : 'Failed to create folder';\r\n      setError(message);\r\n      return null;\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [user?.uid]);\r\n\r\n  const renameFolder = useCallback(async (id: string, name: string): Promise<Folder | null> => {\r\n    if (!user?.uid) return null;\r\n    \r\n    setLoading(true);\r\n    setError(null);\r\n    \r\n    try {\r\n      const headers = await getAuthHeaders();\r\n      const response = await fetch(`/api/folders/${id}`, {\r\n        method: 'PUT',\r\n        headers,\r\n        body: JSON.stringify({ name })\r\n      });\r\n      \r\n      const data = await response.json();\r\n      \r\n      if (!response.ok) {\r\n        throw new Error(data.error || 'Failed to rename folder');\r\n      }\r\n      \r\n      setFolders(prev => prev.map(f => f.id === id ? data.folder : f));\r\n      return data.folder;\r\n    } catch (err) {\r\n      const message = err instanceof Error ? err.message : 'Failed to rename folder';\r\n      setError(message);\r\n      return null;\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [user?.uid]);\r\n\r\n  const deleteFolder = useCallback(async (id: string): Promise<boolean> => {\r\n    if (!user?.uid) return false;\r\n    \r\n    setLoading(true);\r\n    setError(null);\r\n    \r\n    try {\r\n      const headers = await getAuthHeaders();\r\n      const response = await fetch(`/api/folders/${id}`, {\r\n        method: 'DELETE',\r\n        headers\r\n      });\r\n      \r\n      const data = await response.json();\r\n      \r\n      if (!response.ok) {\r\n        throw new Error(data.error || 'Failed to delete folder');\r\n      }\r\n      \r\n      setFolders(prev => prev.filter(f => f.id !== id));\r\n      return true;\r\n    } catch (err) {\r\n      const message = err instanceof Error ? err.message : 'Failed to delete folder';\r\n      setError(message);\r\n      return false;\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [user?.uid]);\r\n\r\n  const moveFolder = useCallback(async (id: string, newParentId: string | null): Promise<Folder | null> => {\r\n    if (!user?.uid) return null;\r\n    \r\n    setLoading(true);\r\n    setError(null);\r\n    \r\n    try {\r\n      const headers = await getAuthHeaders();\r\n      const response = await fetch(`/api/folders/${id}/move`, {\r\n        method: 'POST',\r\n        headers,\r\n        body: JSON.stringify({ newParentId })\r\n      });\r\n      \r\n      const data = await response.json();\r\n      \r\n      if (!response.ok) {\r\n        throw new Error(data.error || 'Failed to move folder');\r\n      }\r\n      \r\n      // Refresh folders to get updated paths\r\n      await fetchFolders();\r\n      return data.folder;\r\n    } catch (err) {\r\n      const message = err instanceof Error ? err.message : 'Failed to move folder';\r\n      setError(message);\r\n      return null;\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [user?.uid, fetchFolders]);\r\n\r\n  return {\r\n    folders,\r\n    loading,\r\n    error,\r\n    pagination,\r\n    fetchFolders,\r\n    fetchFoldersPaginated,\r\n    fetchFolderPath,\r\n    createFolder,\r\n    renameFolder,\r\n    deleteFolder,\r\n    moveFolder,\r\n    setPage,\r\n    setPageSize,\r\n  };\r\n}\r\n","\"use client\";\r\n\r\nimport { useState, useCallback } from 'react';\r\nimport { useAuth } from '@/lib/firebase/AuthContext';\r\nimport { Document } from '@/lib/db/types';\r\nimport { getIdToken } from './useAuthenticatedFetch';\r\n\r\nexport type { Document };\r\n\r\nexport interface UploadProgress {\r\n  fileName: string;\r\n  progress: number;\r\n  status: 'pending' | 'uploading' | 'completed' | 'error' | 'cancelled';\r\n  error?: string;\r\n  abortController?: AbortController;\r\n}\r\n\r\nexport interface PaginationState {\r\n  currentPage: number;\r\n  pageSize: number;\r\n  totalItems: number;\r\n  totalPages: number;\r\n}\r\n\r\nexport interface UseDocumentsReturn {\r\n  documents: Document[];\r\n  loading: boolean;\r\n  error: string | null;\r\n  uploadProgress: Map<string, UploadProgress>;\r\n  pagination: PaginationState;\r\n  fetchDocuments: (folderId?: string | null) => Promise<void>;\r\n  fetchDocumentsPaginated: (folderId?: string | null, page?: number, pageSize?: number) => Promise<void>;\r\n  searchDocuments: (query: string) => Promise<void>;\r\n  uploadDocument: (file: File, folderId?: string | null) => Promise<Document | null>;\r\n  uploadMultipleDocuments: (files: File[], folderId?: string | null) => Promise<void>;\r\n  cancelUpload: (fileName: string) => void;\r\n  deleteDocument: (id: string) => Promise<boolean>;\r\n  moveDocument: (id: string, newFolderId: string | null) => Promise<Document | null>;\r\n  renameDocument: (id: string, newName: string) => Promise<Document | null>;\r\n  clearError: () => void;\r\n  setPage: (page: number) => void;\r\n  setPageSize: (pageSize: number) => void;\r\n}\r\n\r\n/**\r\n * Helper to create authenticated headers with JWT token\r\n */\r\nasync function getAuthHeaders(): Promise<HeadersInit> {\r\n  const token = await getIdToken();\r\n  if (!token) {\r\n    throw new Error('Not authenticated');\r\n  }\r\n  return {\r\n    'Authorization': `Bearer ${token}`,\r\n    'Content-Type': 'application/json',\r\n  };\r\n}\r\n\r\nexport function useDocuments(): UseDocumentsReturn {\r\n  const { user } = useAuth();\r\n  const [documents, setDocuments] = useState<Document[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [uploadProgress, setUploadProgress] = useState<Map<string, UploadProgress>>(new Map());\r\n  const [pagination, setPagination] = useState<PaginationState>({\r\n    currentPage: 1,\r\n    pageSize: 20,\r\n    totalItems: 0,\r\n    totalPages: 0,\r\n  });\r\n\r\n  const clearError = useCallback(() => setError(null), []);\r\n\r\n  const setPage = useCallback((page: number) => {\r\n    setPagination(prev => ({ ...prev, currentPage: page }));\r\n  }, []);\r\n\r\n  const setPageSize = useCallback((pageSize: number) => {\r\n    setPagination(prev => ({ ...prev, pageSize, currentPage: 1 }));\r\n  }, []);\r\n\r\n  const fetchDocuments = useCallback(async (folderId?: string | null) => {\r\n    if (!user) return;\r\n    \r\n    setLoading(true);\r\n    setError(null);\r\n    \r\n    try {\r\n      const headers = await getAuthHeaders();\r\n      const params = new URLSearchParams();\r\n      if (folderId !== undefined) {\r\n        params.set('folderId', folderId === null ? 'null' : folderId);\r\n      }\r\n      \r\n      const response = await fetch(`/api/documents?${params}`, { headers });\r\n      const data = await response.json();\r\n      \r\n      if (!response.ok) {\r\n        throw new Error(data.error || 'Failed to fetch documents');\r\n      }\r\n      \r\n      setDocuments(data.documents);\r\n      setPagination(prev => ({\r\n        ...prev,\r\n        totalItems: data.documents.length,\r\n        totalPages: 1,\r\n        currentPage: 1,\r\n      }));\r\n    } catch (err) {\r\n      const message = err instanceof Error ? err.message : 'Failed to fetch documents';\r\n      setError(message);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [user]);\r\n\r\n  const fetchDocumentsPaginated = useCallback(async (\r\n    folderId?: string | null,\r\n    page?: number,\r\n    pageSize?: number\r\n  ) => {\r\n    if (!user) return;\r\n    \r\n    const currentPageSize = pageSize ?? pagination.pageSize;\r\n    const currentPage = page ?? pagination.currentPage;\r\n    \r\n    setLoading(true);\r\n    setError(null);\r\n    \r\n    try {\r\n      const headers = await getAuthHeaders();\r\n      const params = new URLSearchParams({ \r\n        page: currentPage.toString(),\r\n        pageSize: currentPageSize.toString(),\r\n      });\r\n      if (folderId !== undefined) {\r\n        params.set('folderId', folderId === null ? 'null' : folderId);\r\n      }\r\n      \r\n      const response = await fetch(`/api/documents?${params}`, { headers });\r\n      const data = await response.json();\r\n      \r\n      if (!response.ok) {\r\n        throw new Error(data.error || 'Failed to fetch documents');\r\n      }\r\n      \r\n      setDocuments(data.documents);\r\n      setPagination({\r\n        currentPage,\r\n        pageSize: currentPageSize,\r\n        totalItems: data.total,\r\n        totalPages: Math.ceil(data.total / currentPageSize),\r\n      });\r\n    } catch (err) {\r\n      const message = err instanceof Error ? err.message : 'Failed to fetch documents';\r\n      setError(message);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [user, pagination.pageSize, pagination.currentPage]);\r\n\r\n  const searchDocuments = useCallback(async (query: string) => {\r\n    if (!user) return;\r\n    \r\n    setLoading(true);\r\n    setError(null);\r\n    \r\n    try {\r\n      const headers = await getAuthHeaders();\r\n      const params = new URLSearchParams({ search: query });\r\n      \r\n      const response = await fetch(`/api/documents?${params}`, { headers });\r\n      const data = await response.json();\r\n      \r\n      if (!response.ok) {\r\n        throw new Error(data.error || 'Failed to search documents');\r\n      }\r\n      \r\n      setDocuments(data.documents);\r\n    } catch (err) {\r\n      const message = err instanceof Error ? err.message : 'Failed to search documents';\r\n      setError(message);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [user]);\r\n\r\n  const updateUploadProgress = useCallback((fileName: string, update: Partial<UploadProgress>) => {\r\n    setUploadProgress(prev => {\r\n      const newMap = new Map(prev);\r\n      const current = newMap.get(fileName) || { \r\n        fileName, \r\n        progress: 0, \r\n        status: 'pending' as const \r\n      };\r\n      newMap.set(fileName, { ...current, ...update });\r\n      return newMap;\r\n    });\r\n  }, []);\r\n\r\n  const uploadDocument = useCallback(async (\r\n    file: File, \r\n    folderId?: string | null\r\n  ): Promise<Document | null> => {\r\n    if (!user) return null;\r\n\r\n    const abortController = new AbortController();\r\n    \r\n    updateUploadProgress(file.name, { \r\n      status: 'uploading', \r\n      progress: 0,\r\n      abortController \r\n    });\r\n\r\n    try {\r\n      // Get JWT token for authentication\r\n      const token = await getIdToken();\r\n      if (!token) {\r\n        throw new Error('Not authenticated');\r\n      }\r\n\r\n      const formData = new FormData();\r\n      formData.append('file', file);\r\n      if (folderId) {\r\n        formData.append('folderId', folderId);\r\n      }\r\n\r\n      // Use XMLHttpRequest for progress tracking - Requirements 4.3\r\n      const document = await new Promise<Document>((resolve, reject) => {\r\n        const xhr = new XMLHttpRequest();\r\n        \r\n        xhr.upload.addEventListener('progress', (event) => {\r\n          if (event.lengthComputable) {\r\n            const progress = Math.round((event.loaded / event.total) * 100);\r\n            updateUploadProgress(file.name, { progress });\r\n          }\r\n        });\r\n\r\n        xhr.addEventListener('load', () => {\r\n          if (xhr.status >= 200 && xhr.status < 300) {\r\n            const data = JSON.parse(xhr.responseText);\r\n            resolve(data.document);\r\n          } else {\r\n            try {\r\n              const data = JSON.parse(xhr.responseText);\r\n              reject(new Error(data.error || 'Upload failed'));\r\n            } catch {\r\n              reject(new Error('Upload failed'));\r\n            }\r\n          }\r\n        });\r\n\r\n        xhr.addEventListener('error', () => {\r\n          reject(new Error('Network error during upload'));\r\n        });\r\n\r\n        xhr.addEventListener('abort', () => {\r\n          reject(new Error('Upload cancelled'));\r\n        });\r\n\r\n        // Handle abort signal - Requirements 4.3 (cancel option)\r\n        abortController.signal.addEventListener('abort', () => {\r\n          xhr.abort();\r\n        });\r\n\r\n        xhr.open('POST', '/api/documents/upload');\r\n        // Set Authorization header with JWT token\r\n        xhr.setRequestHeader('Authorization', `Bearer ${token}`);\r\n        xhr.send(formData);\r\n      });\r\n\r\n      updateUploadProgress(file.name, { status: 'completed', progress: 100 });\r\n      \r\n      // Add to documents list\r\n      setDocuments(prev => [document, ...prev]);\r\n      \r\n      return document;\r\n    } catch (err) {\r\n      const message = err instanceof Error ? err.message : 'Upload failed';\r\n      const isCancelled = message === 'Upload cancelled';\r\n      \r\n      updateUploadProgress(file.name, { \r\n        status: isCancelled ? 'cancelled' : 'error', \r\n        error: message \r\n      });\r\n      \r\n      if (!isCancelled) {\r\n        setError(message);\r\n      }\r\n      \r\n      return null;\r\n    }\r\n  }, [user, updateUploadProgress]);\r\n\r\n  // Multiple file upload support - Requirements 4.2\r\n  const uploadMultipleDocuments = useCallback(async (\r\n    files: File[], \r\n    folderId?: string | null\r\n  ): Promise<void> => {\r\n    // Initialize progress for all files\r\n    files.forEach(file => {\r\n      updateUploadProgress(file.name, { status: 'pending', progress: 0 });\r\n    });\r\n\r\n    // Upload files sequentially to avoid overwhelming the server\r\n    for (const file of files) {\r\n      const progress = uploadProgress.get(file.name);\r\n      if (progress?.status === 'cancelled') continue;\r\n      \r\n      await uploadDocument(file, folderId);\r\n    }\r\n  }, [uploadDocument, uploadProgress, updateUploadProgress]);\r\n\r\n  const cancelUpload = useCallback((fileName: string) => {\r\n    const progress = uploadProgress.get(fileName);\r\n    if (progress?.abortController) {\r\n      progress.abortController.abort();\r\n    }\r\n    updateUploadProgress(fileName, { status: 'cancelled' });\r\n  }, [uploadProgress, updateUploadProgress]);\r\n\r\n  const deleteDocument = useCallback(async (id: string): Promise<boolean> => {\r\n    if (!user) return false;\r\n    \r\n    try {\r\n      const headers = await getAuthHeaders();\r\n      const response = await fetch(`/api/documents/${id}`, {\r\n        method: 'DELETE',\r\n        headers\r\n      });\r\n      \r\n      if (!response.ok) {\r\n        const data = await response.json();\r\n        throw new Error(data.error || 'Failed to delete document');\r\n      }\r\n      \r\n      setDocuments(prev => prev.filter(d => d.id !== id));\r\n      return true;\r\n    } catch (err) {\r\n      const message = err instanceof Error ? err.message : 'Failed to delete document';\r\n      setError(message);\r\n      return false;\r\n    }\r\n  }, [user]);\r\n\r\n  const moveDocument = useCallback(async (\r\n    id: string, \r\n    newFolderId: string | null\r\n  ): Promise<Document | null> => {\r\n    if (!user) return null;\r\n    \r\n    try {\r\n      const headers = await getAuthHeaders();\r\n      const response = await fetch(`/api/documents/${id}`, {\r\n        method: 'PATCH',\r\n        headers,\r\n        body: JSON.stringify({ folderId: newFolderId })\r\n      });\r\n      \r\n      const data = await response.json();\r\n      \r\n      if (!response.ok) {\r\n        throw new Error(data.error || 'Failed to move document');\r\n      }\r\n      \r\n      setDocuments(prev => \r\n        prev.map(d => d.id === id ? data.document : d)\r\n      );\r\n      \r\n      return data.document;\r\n    } catch (err) {\r\n      const message = err instanceof Error ? err.message : 'Failed to move document';\r\n      setError(message);\r\n      return null;\r\n    }\r\n  }, [user]);\r\n\r\n  const renameDocument = useCallback(async (\r\n    id: string, \r\n    newName: string\r\n  ): Promise<Document | null> => {\r\n    if (!user) return null;\r\n    \r\n    try {\r\n      const headers = await getAuthHeaders();\r\n      const response = await fetch(`/api/documents/${id}`, {\r\n        method: 'PATCH',\r\n        headers,\r\n        body: JSON.stringify({ name: newName })\r\n      });\r\n      \r\n      const data = await response.json();\r\n      \r\n      if (!response.ok) {\r\n        throw new Error(data.error || 'Failed to rename document');\r\n      }\r\n      \r\n      setDocuments(prev => \r\n        prev.map(d => d.id === id ? data.document : d)\r\n      );\r\n      \r\n      return data.document;\r\n    } catch (err) {\r\n      const message = err instanceof Error ? err.message : 'Failed to rename document';\r\n      setError(message);\r\n      return null;\r\n    }\r\n  }, [user]);\r\n\r\n  return {\r\n    documents,\r\n    loading,\r\n    error,\r\n    uploadProgress,\r\n    pagination,\r\n    fetchDocuments,\r\n    fetchDocumentsPaginated,\r\n    searchDocuments,\r\n    uploadDocument,\r\n    uploadMultipleDocuments,\r\n    cancelUpload,\r\n    deleteDocument,\r\n    moveDocument,\r\n    renameDocument,\r\n    clearError,\r\n    setPage,\r\n    setPageSize,\r\n  };\r\n}\r\n"],"names":[],"mappings":"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"}