{"version":3,"sources":["../../../../src/components/documents/FileUpload.tsx","../../../../src/lib/s3/config.ts","../../../../src/components/documents/FolderPickerModal.tsx","../../../../src/components/documents/DocumentGrid.tsx","../../../../src/components/documents/DocumentList.tsx","../../../../src/components/documents/DocumentPreview.tsx","../../../../src/components/documents/MoveDocumentModal.tsx","../../../../src/components/documents/ViewToggle.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useCallback, useRef, DragEvent, ChangeEvent } from 'react';\r\nimport { S3_CONFIG } from '@/lib/s3';\r\nimport { UploadProgress } from '@/lib/hooks/useDocuments';\r\n\r\ninterface FileUploadProps {\r\n  onUpload: (files: File[]) => Promise<void>;\r\n  uploadProgress: Map<string, UploadProgress>;\r\n  onCancelUpload: (fileName: string) => void;\r\n  disabled?: boolean;\r\n  folderId?: string | null;\r\n}\r\n\r\nexport function FileUpload({ \r\n  onUpload, \r\n  uploadProgress, \r\n  onCancelUpload,\r\n  disabled = false \r\n}: FileUploadProps) {\r\n  const [isDragging, setIsDragging] = useState(false);\r\n  const [validationErrors, setValidationErrors] = useState<string[]>([]);\r\n  const fileInputRef = useRef<HTMLInputElement>(null);\r\n\r\n  const validateFiles = useCallback((files: File[]): { valid: File[]; errors: string[] } => {\r\n    const valid: File[] = [];\r\n    const errors: string[] = [];\r\n    const maxSize = S3_CONFIG.MAX_FILE_SIZE;\r\n\r\n    for (const file of files) {\r\n      // Check file type - Requirements 4.1\r\n      if (file.type !== 'application/pdf') {\r\n        errors.push(`\"${file.name}\" is not a PDF file. Only PDF files are allowed.`);\r\n        continue;\r\n      }\r\n\r\n      // Check file extension\r\n      const extension = file.name.split('.').pop()?.toLowerCase();\r\n      if (extension !== 'pdf') {\r\n        errors.push(`\"${file.name}\" does not have a .pdf extension.`);\r\n        continue;\r\n      }\r\n\r\n      // Check file size - Requirements 4.1 (50MB limit)\r\n      if (file.size > maxSize) {\r\n        const sizeMB = (file.size / (1024 * 1024)).toFixed(2);\r\n        errors.push(`\"${file.name}\" exceeds the 50MB limit (${sizeMB}MB).`);\r\n        continue;\r\n      }\r\n\r\n      valid.push(file);\r\n    }\r\n\r\n    return { valid, errors };\r\n  }, []);\r\n\r\n  const handleFiles = useCallback(async (files: FileList | File[]) => {\r\n    const fileArray = Array.from(files);\r\n    const { valid, errors } = validateFiles(fileArray);\r\n    \r\n    setValidationErrors(errors);\r\n    \r\n    if (valid.length > 0) {\r\n      await onUpload(valid);\r\n    }\r\n  }, [validateFiles, onUpload]);\r\n\r\n  // Drag and drop handlers - Requirements 4.2\r\n  const handleDragEnter = useCallback((e: DragEvent<HTMLDivElement>) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    if (!disabled) {\r\n      setIsDragging(true);\r\n    }\r\n  }, [disabled]);\r\n\r\n  const handleDragLeave = useCallback((e: DragEvent<HTMLDivElement>) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    setIsDragging(false);\r\n  }, []);\r\n\r\n  const handleDragOver = useCallback((e: DragEvent<HTMLDivElement>) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n  }, []);\r\n\r\n  const handleDrop = useCallback((e: DragEvent<HTMLDivElement>) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    setIsDragging(false);\r\n    \r\n    if (disabled) return;\r\n    \r\n    const files = e.dataTransfer.files;\r\n    if (files.length > 0) {\r\n      handleFiles(files);\r\n    }\r\n  }, [disabled, handleFiles]);\r\n\r\n  const handleFileInputChange = useCallback((e: ChangeEvent<HTMLInputElement>) => {\r\n    const files = e.target.files;\r\n    if (files && files.length > 0) {\r\n      handleFiles(files);\r\n    }\r\n    // Reset input so same file can be selected again\r\n    if (fileInputRef.current) {\r\n      fileInputRef.current.value = '';\r\n    }\r\n  }, [handleFiles]);\r\n\r\n  const handleClick = useCallback(() => {\r\n    if (!disabled) {\r\n      fileInputRef.current?.click();\r\n    }\r\n  }, [disabled]);\r\n\r\n  const activeUploads = Array.from(uploadProgress.entries()).filter(\r\n    ([, progress]) => progress.status === 'uploading' || progress.status === 'pending'\r\n  );\r\n\r\n  const hasActiveUploads = activeUploads.length > 0;\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      {/* Drop Zone - Requirements 1.3, 6.4: Responsive design */}\r\n      <div\r\n        onClick={handleClick}\r\n        onDragEnter={handleDragEnter}\r\n        onDragLeave={handleDragLeave}\r\n        onDragOver={handleDragOver}\r\n        onDrop={handleDrop}\r\n        onKeyDown={(e) => {\r\n          if (e.key === 'Enter' || e.key === ' ') {\r\n            e.preventDefault();\r\n            handleClick();\r\n          }\r\n        }}\r\n        tabIndex={disabled ? -1 : 0}\r\n        role=\"button\"\r\n        aria-label=\"Upload PDF files. Click to browse or drag and drop files here.\"\r\n        aria-disabled={disabled}\r\n        className={`\r\n          relative cursor-pointer rounded-lg border-2 border-dashed p-6 sm:p-8 text-center transition-colors active:scale-[0.99] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2\r\n          ${isDragging \r\n            ? 'border-blue-500 bg-blue-50' \r\n            : 'border-gray-300 hover:border-gray-400 hover:bg-gray-50'\r\n          }\r\n          ${disabled ? 'cursor-not-allowed opacity-50' : ''}\r\n        `}\r\n      >\r\n        <input\r\n          ref={fileInputRef}\r\n          type=\"file\"\r\n          accept=\".pdf,application/pdf\"\r\n          multiple\r\n          onChange={handleFileInputChange}\r\n          className=\"hidden\"\r\n          disabled={disabled}\r\n          aria-label=\"Select PDF files to upload\"\r\n        />\r\n        \r\n        <div className=\"flex flex-col items-center\">\r\n          <svg \r\n            className={`h-10 w-10 sm:h-12 sm:w-12 ${isDragging ? 'text-blue-500' : 'text-gray-400'}`}\r\n            fill=\"none\" \r\n            stroke=\"currentColor\" \r\n            viewBox=\"0 0 24 24\"\r\n            aria-hidden=\"true\"\r\n          >\r\n            <path \r\n              strokeLinecap=\"round\" \r\n              strokeLinejoin=\"round\" \r\n              strokeWidth={2} \r\n              d=\"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12\" \r\n            />\r\n          </svg>\r\n          \r\n          <p className=\"mt-3 sm:mt-4 text-sm font-medium text-gray-900\">\r\n            {isDragging ? 'Drop files here' : 'Tap to select PDF files'}\r\n          </p>\r\n          <p className=\"mt-1 text-xs text-gray-600 hidden sm:block\">\r\n            or drag and drop\r\n          </p>\r\n          <p className=\"mt-2 text-xs text-gray-500\">\r\n            PDF files only, max 50MB each\r\n          </p>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Validation Errors - Requirements 4.5 */}\r\n      {validationErrors.length > 0 && (\r\n        <div className=\"rounded-lg bg-red-50 p-4\" role=\"alert\" aria-live=\"polite\">\r\n          <div className=\"flex\">\r\n            <svg className=\"h-5 w-5 text-red-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n            </svg>\r\n            <div className=\"ml-3\">\r\n              <h3 className=\"text-sm font-medium text-red-800\">\r\n                Some files could not be uploaded\r\n              </h3>\r\n              <ul className=\"mt-2 list-disc pl-5 text-sm text-red-700\" aria-label=\"Upload errors\">\r\n                {validationErrors.map((error, index) => (\r\n                  <li key={index}>{error}</li>\r\n                ))}\r\n              </ul>\r\n            </div>\r\n          </div>\r\n          <button\r\n            onClick={() => setValidationErrors([])}\r\n            className=\"mt-2 text-sm text-red-600 hover:text-red-800 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-red-500 focus-visible:ring-offset-2 rounded\"\r\n            aria-label=\"Dismiss error messages\"\r\n          >\r\n            Dismiss\r\n          </button>\r\n        </div>\r\n      )}\r\n\r\n      {/* Upload Progress - Requirements 4.3 */}\r\n      {hasActiveUploads && (\r\n        <div className=\"space-y-3\">\r\n          <h4 className=\"text-sm font-medium text-gray-700\">Uploading files...</h4>\r\n          {activeUploads.map(([fileName, progress]) => (\r\n            <UploadProgressItem\r\n              key={fileName}\r\n              fileName={fileName}\r\n              progress={progress}\r\n              onCancel={() => onCancelUpload(fileName)}\r\n            />\r\n          ))}\r\n        </div>\r\n      )}\r\n\r\n      {/* Completed/Failed Uploads */}\r\n      {Array.from(uploadProgress.entries())\r\n        .filter(([, p]) => p.status === 'completed' || p.status === 'error' || p.status === 'cancelled')\r\n        .length > 0 && (\r\n        <div className=\"space-y-2\">\r\n          {Array.from(uploadProgress.entries())\r\n            .filter(([, p]) => p.status === 'completed' || p.status === 'error' || p.status === 'cancelled')\r\n            .map(([fileName, progress]) => (\r\n              <UploadStatusItem key={fileName} fileName={fileName} progress={progress} />\r\n            ))}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface UploadProgressItemProps {\r\n  fileName: string;\r\n  progress: UploadProgress;\r\n  onCancel: () => void;\r\n}\r\n\r\nfunction UploadProgressItem({ fileName, progress, onCancel }: UploadProgressItemProps) {\r\n  return (\r\n    <div className=\"rounded-lg border border-gray-200 bg-white p-3\" role=\"status\" aria-label={`Uploading ${fileName}: ${progress.progress}% complete`}>\r\n      <div className=\"flex items-center justify-between\">\r\n        <div className=\"flex items-center gap-3 min-w-0 flex-1\">\r\n          <svg className=\"h-5 w-5 flex-shrink-0 text-red-500\" fill=\"currentColor\" viewBox=\"0 0 20 20\" aria-hidden=\"true\">\r\n            <path fillRule=\"evenodd\" d=\"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z\" clipRule=\"evenodd\" />\r\n          </svg>\r\n          <span className=\"truncate text-sm font-medium text-gray-900\">{fileName}</span>\r\n        </div>\r\n        <div className=\"flex items-center gap-3\">\r\n          <span className=\"text-sm text-gray-600\" aria-live=\"polite\">{progress.progress}%</span>\r\n          {/* Cancel button - Requirements 4.3 */}\r\n          <button\r\n            onClick={onCancel}\r\n            className=\"rounded p-1 text-gray-400 hover:bg-gray-100 hover:text-gray-600 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2\"\r\n            aria-label={`Cancel upload of ${fileName}`}\r\n          >\r\n            <svg className=\"h-4 w-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n            </svg>\r\n          </button>\r\n        </div>\r\n      </div>\r\n      {/* Progress bar - Requirements 4.3 */}\r\n      <div \r\n        className=\"mt-2 h-1.5 w-full overflow-hidden rounded-full bg-gray-200\"\r\n        role=\"progressbar\"\r\n        aria-valuenow={progress.progress}\r\n        aria-valuemin={0}\r\n        aria-valuemax={100}\r\n        aria-label={`Upload progress for ${fileName}`}\r\n      >\r\n        <div \r\n          className=\"h-full rounded-full bg-blue-600 transition-all duration-300\"\r\n          style={{ width: `${progress.progress}%` }}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface UploadStatusItemProps {\r\n  fileName: string;\r\n  progress: UploadProgress;\r\n}\r\n\r\nfunction UploadStatusItem({ fileName, progress }: UploadStatusItemProps) {\r\n  const isCompleted = progress.status === 'completed';\r\n  const isCancelled = progress.status === 'cancelled';\r\n  \r\n  return (\r\n    <div className={`\r\n      flex items-center gap-3 rounded-lg p-3\r\n      ${isCompleted ? 'bg-green-50' : isCancelled ? 'bg-gray-50' : 'bg-red-50'}\r\n    `}>\r\n      {isCompleted ? (\r\n        <svg className=\"h-5 w-5 text-green-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\r\n        </svg>\r\n      ) : isCancelled ? (\r\n        <svg className=\"h-5 w-5 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636\" />\r\n        </svg>\r\n      ) : (\r\n        <svg className=\"h-5 w-5 text-red-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n        </svg>\r\n      )}\r\n      <div className=\"min-w-0 flex-1\">\r\n        <p className={`truncate text-sm font-medium ${\r\n          isCompleted ? 'text-green-800' : isCancelled ? 'text-gray-600' : 'text-red-800'\r\n        }`}>\r\n          {fileName}\r\n        </p>\r\n        {progress.error && !isCancelled && (\r\n          <p className=\"text-xs text-red-600\">{progress.error}</p>\r\n        )}\r\n        {isCancelled && (\r\n          <p className=\"text-xs text-gray-500\">Upload cancelled</p>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import {\r\n  S3Client,\r\n  PutObjectCommand,\r\n  DeleteObjectCommand,\r\n  GetObjectCommand,\r\n  HeadObjectCommand,\r\n} from \"@aws-sdk/client-s3\";\r\nimport { getSignedUrl } from \"@aws-sdk/s3-request-presigner\";\r\n\r\nlet s3Client: S3Client | undefined;\r\n\r\n/**\r\n * Get or create the S3 client singleton\r\n */\r\nexport function getS3Client(): S3Client {\r\n  if (!s3Client) {\r\n    s3Client = new S3Client({\r\n      endpoint: process.env.S3_ENDPOINT,\r\n      region: process.env.S3_REGION || \"us-east-1\",\r\n      credentials: {\r\n        accessKeyId: process.env.S3_ACCESS_KEY_ID || \"\",\r\n        secretAccessKey: process.env.S3_SECRET_ACCESS_KEY || \"\",\r\n      },\r\n      forcePathStyle: true,\r\n    });\r\n  }\r\n  return s3Client;\r\n}\r\n\r\n/**\r\n * Get the S3 bucket name from environment\r\n */\r\nexport function getS3BucketName(): string {\r\n  return process.env.S3_BUCKET_NAME || \"setutor-documents\";\r\n}\r\n\r\n/**\r\n * Generate a unique S3 key for a file\r\n * Format: userId/folderId/timestamp-originalFilename\r\n */\r\nexport function generateS3Key(\r\n  userId: string,\r\n  folderId: string,\r\n  originalFilename: string\r\n): string {\r\n  const timestamp = Date.now();\r\n  const sanitizedFilename = originalFilename.replace(/[^a-zA-Z0-9.-]/g, \"_\");\r\n  return `${userId}/${folderId}/${timestamp}-${sanitizedFilename}`;\r\n}\r\n\r\n/**\r\n * Upload a file to S3\r\n * @param buffer - File content as Buffer\r\n * @param s3Key - The S3 key (path) for the file\r\n * @param contentType - MIME type of the file\r\n * @returns The S3 URL of the uploaded file\r\n */\r\nexport async function uploadFileToS3(\r\n  buffer: Buffer,\r\n  s3Key: string,\r\n  contentType: string\r\n): Promise<{ s3Key: string; s3Url: string }> {\r\n  const client = getS3Client();\r\n  const bucket = getS3BucketName();\r\n\r\n  const command = new PutObjectCommand({\r\n    Bucket: bucket,\r\n    Key: s3Key,\r\n    Body: buffer,\r\n    ContentType: contentType,\r\n  });\r\n\r\n  await client.send(command);\r\n\r\n  // Construct the S3 URL\r\n  const endpoint = process.env.S3_ENDPOINT || \"\";\r\n  const s3Url = `${endpoint}/${bucket}/${s3Key}`;\r\n\r\n  return { s3Key, s3Url };\r\n}\r\n\r\n/**\r\n * Generate a presigned URL for secure file access\r\n * @param s3Key - The S3 key of the file\r\n * @param expiresIn - URL expiration time in seconds (default: 1 hour)\r\n * @returns Presigned URL for secure access\r\n */\r\nexport async function generatePresignedUrl(\r\n  s3Key: string,\r\n  expiresIn: number = 3600\r\n): Promise<string> {\r\n  const client = getS3Client();\r\n  const bucket = getS3BucketName();\r\n\r\n  const command = new GetObjectCommand({\r\n    Bucket: bucket,\r\n    Key: s3Key,\r\n  });\r\n\r\n  const presignedUrl = await getSignedUrl(client, command, { expiresIn });\r\n  return presignedUrl;\r\n}\r\n\r\n/**\r\n * Generate a presigned URL for file upload\r\n * @param s3Key - The S3 key where the file will be uploaded\r\n * @param contentType - MIME type of the file\r\n * @param expiresIn - URL expiration time in seconds (default: 15 minutes)\r\n * @returns Presigned URL for upload\r\n */\r\nexport async function generateUploadPresignedUrl(\r\n  s3Key: string,\r\n  contentType: string,\r\n  expiresIn: number = 900\r\n): Promise<string> {\r\n  const client = getS3Client();\r\n  const bucket = getS3BucketName();\r\n\r\n  const command = new PutObjectCommand({\r\n    Bucket: bucket,\r\n    Key: s3Key,\r\n    ContentType: contentType,\r\n  });\r\n\r\n  const presignedUrl = await getSignedUrl(client, command, { expiresIn });\r\n  return presignedUrl;\r\n}\r\n\r\n/**\r\n * Delete a file from S3\r\n * @param s3Key - The S3 key of the file to delete\r\n */\r\nexport async function deleteFileFromS3(s3Key: string): Promise<void> {\r\n  const client = getS3Client();\r\n  const bucket = getS3BucketName();\r\n\r\n  const command = new DeleteObjectCommand({\r\n    Bucket: bucket,\r\n    Key: s3Key,\r\n  });\r\n\r\n  await client.send(command);\r\n}\r\n\r\n/**\r\n * Check if a file exists in S3\r\n * @param s3Key - The S3 key to check\r\n * @returns true if file exists, false otherwise\r\n */\r\nexport async function fileExistsInS3(s3Key: string): Promise<boolean> {\r\n  const client = getS3Client();\r\n  const bucket = getS3BucketName();\r\n\r\n  try {\r\n    const command = new HeadObjectCommand({\r\n      Bucket: bucket,\r\n      Key: s3Key,\r\n    });\r\n    await client.send(command);\r\n    return true;\r\n  } catch {\r\n    // File doesn't exist or access denied\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Validate file for upload\r\n * @param file - File object with size and type\r\n * @returns Validation result with success flag and optional error message\r\n */\r\nexport function validateFileForUpload(file: {\r\n  size: number;\r\n  type: string;\r\n  name: string;\r\n}): { valid: boolean; error?: string } {\r\n  const MAX_FILE_SIZE = 50 * 1024 * 1024; // 50MB\r\n  const ALLOWED_MIME_TYPES = [\"application/pdf\"];\r\n\r\n  // Check file size\r\n  if (file.size > MAX_FILE_SIZE) {\r\n    return {\r\n      valid: false,\r\n      error: `File size exceeds the 50MB limit. Current size: ${(file.size / (1024 * 1024)).toFixed(2)}MB`,\r\n    };\r\n  }\r\n\r\n  // Check file type\r\n  if (!ALLOWED_MIME_TYPES.includes(file.type)) {\r\n    return {\r\n      valid: false,\r\n      error: `Invalid file type. Only PDF files are allowed. Received: ${file.type}`,\r\n    };\r\n  }\r\n\r\n  // Check file extension\r\n  const extension = file.name.split(\".\").pop()?.toLowerCase();\r\n  if (extension !== \"pdf\") {\r\n    return {\r\n      valid: false,\r\n      error: `Invalid file extension. Only .pdf files are allowed.`,\r\n    };\r\n  }\r\n\r\n  return { valid: true };\r\n}\r\n\r\n// Export constants for use in other modules\r\nexport const S3_CONFIG = {\r\n  MAX_FILE_SIZE: 50 * 1024 * 1024, // 50MB\r\n  ALLOWED_MIME_TYPES: [\"application/pdf\"],\r\n  DEFAULT_PRESIGNED_URL_EXPIRY: 3600, // 1 hour\r\n  DEFAULT_UPLOAD_URL_EXPIRY: 900, // 15 minutes\r\n} as const;\r\n","\"use client\";\r\n\r\nimport { useState, useCallback } from 'react';\r\nimport { Folder } from '@/lib/hooks/useFolders';\r\n\r\ninterface FolderPickerModalProps {\r\n  folders: Folder[];\r\n  selectedFolderId: string | null;\r\n  onSelect: (folder: Folder | null) => void;\r\n  onClose: () => void;\r\n  allowRoot?: boolean;\r\n}\r\n\r\nexport function FolderPickerModal({\r\n  folders,\r\n  selectedFolderId,\r\n  onSelect,\r\n  onClose,\r\n  allowRoot = true\r\n}: FolderPickerModalProps) {\r\n  const [expandedFolders, setExpandedFolders] = useState<Set<string>>(new Set());\r\n\r\n  const toggleExpand = useCallback((folderId: string) => {\r\n    setExpandedFolders(prev => {\r\n      const newSet = new Set(prev);\r\n      if (newSet.has(folderId)) {\r\n        newSet.delete(folderId);\r\n      } else {\r\n        newSet.add(folderId);\r\n      }\r\n      return newSet;\r\n    });\r\n  }, []);\r\n\r\n  // Build folder tree structure\r\n  const rootFolders = folders.filter(f => f.parent_id === null);\r\n  \r\n  const getChildFolders = (parentId: string) => \r\n    folders.filter(f => f.parent_id === parentId);\r\n\r\n  const renderFolder = (folder: Folder, level: number = 0) => {\r\n    const children = getChildFolders(folder.id);\r\n    const hasChildren = children.length > 0;\r\n    const isExpanded = expandedFolders.has(folder.id);\r\n    const isSelected = folder.id === selectedFolderId;\r\n\r\n    return (\r\n      <div key={folder.id}>\r\n        <div\r\n          className={`\r\n            flex items-center gap-2 rounded-lg px-3 py-2 cursor-pointer transition-colors\r\n            ${isSelected ? 'bg-blue-100 text-blue-900' : 'hover:bg-gray-100'}\r\n          `}\r\n          style={{ paddingLeft: `${level * 20 + 12}px` }}\r\n        >\r\n          {hasChildren ? (\r\n            <button\r\n              onClick={(e) => {\r\n                e.stopPropagation();\r\n                toggleExpand(folder.id);\r\n              }}\r\n              className=\"p-0.5 hover:bg-gray-200 rounded\"\r\n            >\r\n              <svg\r\n                className={`h-4 w-4 text-gray-500 transition-transform ${isExpanded ? 'rotate-90' : ''}`}\r\n                fill=\"none\"\r\n                stroke=\"currentColor\"\r\n                viewBox=\"0 0 24 24\"\r\n              >\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\r\n              </svg>\r\n            </button>\r\n          ) : (\r\n            <span className=\"w-5\" />\r\n          )}\r\n          \r\n          <button\r\n            onClick={() => onSelect(folder)}\r\n            className=\"flex items-center gap-2 flex-1 text-left\"\r\n          >\r\n            <svg\r\n              className={`h-5 w-5 ${isSelected ? 'text-blue-600' : 'text-yellow-500'}`}\r\n              fill=\"currentColor\"\r\n              viewBox=\"0 0 20 20\"\r\n            >\r\n              <path d=\"M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z\" />\r\n            </svg>\r\n            <span className=\"text-sm font-medium\">{folder.name}</span>\r\n          </button>\r\n        </div>\r\n        \r\n        {hasChildren && isExpanded && (\r\n          <div>\r\n            {children.map(child => renderFolder(child, level + 1))}\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50\">\r\n      <div className=\"w-full max-w-md rounded-lg bg-white shadow-xl\">\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between border-b border-gray-200 px-4 py-3\">\r\n          <h3 className=\"text-lg font-semibold text-gray-900\">Select Folder</h3>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"rounded-lg p-1 text-gray-400 hover:bg-gray-100 hover:text-gray-600\"\r\n          >\r\n            <svg className=\"h-5 w-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n            </svg>\r\n          </button>\r\n        </div>\r\n\r\n        {/* Folder List */}\r\n        <div className=\"max-h-80 overflow-y-auto p-2\">\r\n          {/* Root option */}\r\n          {allowRoot && (\r\n            <button\r\n              onClick={() => onSelect(null)}\r\n              className={`\r\n                flex w-full items-center gap-2 rounded-lg px-3 py-2 text-left transition-colors\r\n                ${selectedFolderId === null ? 'bg-blue-100 text-blue-900' : 'hover:bg-gray-100'}\r\n              `}\r\n            >\r\n              <svg\r\n                className={`h-5 w-5 ${selectedFolderId === null ? 'text-blue-600' : 'text-gray-400'}`}\r\n                fill=\"none\"\r\n                stroke=\"currentColor\"\r\n                viewBox=\"0 0 24 24\"\r\n              >\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6\" />\r\n              </svg>\r\n              <span className=\"text-sm font-medium\">Root (No folder)</span>\r\n            </button>\r\n          )}\r\n\r\n          {/* Folder tree */}\r\n          {rootFolders.length > 0 ? (\r\n            rootFolders.map(folder => renderFolder(folder))\r\n          ) : (\r\n            <div className=\"py-8 text-center text-sm text-gray-500\">\r\n              No folders available\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Footer */}\r\n        <div className=\"flex justify-end gap-3 border-t border-gray-200 px-4 py-3\">\r\n          <button\r\n            onClick={onClose}\r\n            className=\"rounded-lg px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100\"\r\n          >\r\n            Cancel\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","\"use client\";\r\n\r\nimport { memo, useCallback } from 'react';\r\nimport { Document } from '@/lib/db/types';\r\n\r\ninterface DocumentGridProps {\r\n  documents: Document[];\r\n  onPreview: (document: Document) => void;\r\n  onMove: (document: Document) => void;\r\n  onDelete: (document: Document) => void;\r\n}\r\n\r\ninterface DocumentGridItemProps {\r\n  document: Document;\r\n  onPreview: (document: Document) => void;\r\n  onMove: (document: Document) => void;\r\n  onDelete: (document: Document) => void;\r\n}\r\n\r\nconst formatFileSize = (bytes: number) => {\r\n  if (bytes < 1024) return `${bytes} B`;\r\n  if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\r\n  return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\r\n};\r\n\r\nconst formatDate = (date: Date) => {\r\n  return new Date(date).toLocaleDateString('en-US', {\r\n    year: 'numeric',\r\n    month: 'short',\r\n    day: 'numeric'\r\n  });\r\n};\r\n\r\n/**\r\n * Memoized document grid item component\r\n * Requirements: 12.1, 12.3 - Performance optimization with React.memo\r\n */\r\nconst DocumentGridItem = memo(function DocumentGridItem({\r\n  document: doc,\r\n  onPreview,\r\n  onMove,\r\n  onDelete,\r\n}: DocumentGridItemProps) {\r\n  const handlePreview = useCallback(() => onPreview(doc), [doc, onPreview]);\r\n  const handleMove = useCallback((e: React.MouseEvent) => {\r\n    e.stopPropagation();\r\n    onMove(doc);\r\n  }, [doc, onMove]);\r\n  const handleDelete = useCallback((e: React.MouseEvent) => {\r\n    e.stopPropagation();\r\n    onDelete(doc);\r\n  }, [doc, onDelete]);\r\n\r\n  return (\r\n    <div className=\"group relative rounded-lg border border-gray-200 bg-white p-4 shadow-sm transition-shadow hover:shadow-md\">\r\n      {/* Document Icon and Preview Button */}\r\n      <button\r\n        onClick={handlePreview}\r\n        className=\"flex w-full flex-col items-center\"\r\n      >\r\n        <div className=\"flex h-24 w-full items-center justify-center rounded-lg bg-red-50\">\r\n          <svg className=\"h-16 w-16 text-red-500\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n            <path fillRule=\"evenodd\" d=\"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z\" clipRule=\"evenodd\" />\r\n          </svg>\r\n        </div>\r\n      </button>\r\n\r\n      {/* Document Info */}\r\n      <div className=\"mt-3 w-full\">\r\n        <h3 className=\"truncate text-sm font-medium text-gray-900\" title={doc.name}>\r\n          {doc.name}\r\n        </h3>\r\n        <p className=\"mt-1 text-xs text-gray-500\">\r\n          {formatFileSize(doc.file_size)} â€¢ {formatDate(doc.created_at)}\r\n        </p>\r\n      </div>\r\n\r\n      {/* Action Buttons - Visible on hover */}\r\n      <div className=\"absolute right-2 top-2 flex gap-1 opacity-0 transition-opacity group-hover:opacity-100\">\r\n        <button\r\n          onClick={handlePreview}\r\n          className=\"rounded-lg bg-white p-1.5 text-gray-600 shadow-sm hover:bg-gray-100\"\r\n          title=\"Preview\"\r\n        >\r\n          <svg className=\"h-4 w-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" />\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\" />\r\n          </svg>\r\n        </button>\r\n        <button\r\n          onClick={handleMove}\r\n          className=\"rounded-lg bg-white p-1.5 text-gray-600 shadow-sm hover:bg-gray-100\"\r\n          title=\"Move\"\r\n        >\r\n          <svg className=\"h-4 w-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4\" />\r\n          </svg>\r\n        </button>\r\n        <button\r\n          onClick={handleDelete}\r\n          className=\"rounded-lg bg-white p-1.5 text-red-600 shadow-sm hover:bg-red-50\"\r\n          title=\"Delete\"\r\n        >\r\n          <svg className=\"h-4 w-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\r\n          </svg>\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\n/**\r\n * Memoized document grid component\r\n * Requirements: 12.1, 12.3 - Performance optimization with React.memo\r\n */\r\nexport const DocumentGrid = memo(function DocumentGrid({ \r\n  documents, \r\n  onPreview, \r\n  onMove, \r\n  onDelete \r\n}: DocumentGridProps) {\r\n  return (\r\n    <div className=\"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4\">\r\n      {documents.map(doc => (\r\n        <DocumentGridItem\r\n          key={doc.id}\r\n          document={doc}\r\n          onPreview={onPreview}\r\n          onMove={onMove}\r\n          onDelete={onDelete}\r\n        />\r\n      ))}\r\n    </div>\r\n  );\r\n});\r\n","\"use client\";\r\n\r\nimport { memo, useCallback } from 'react';\r\nimport { Document } from '@/lib/db/types';\r\n\r\ninterface DocumentListProps {\r\n  documents: Document[];\r\n  onPreview: (document: Document) => void;\r\n  onMove: (document: Document) => void;\r\n  onDelete: (document: Document) => void;\r\n}\r\n\r\ninterface DocumentListItemProps {\r\n  document: Document;\r\n  onPreview: (document: Document) => void;\r\n  onMove: (document: Document) => void;\r\n  onDelete: (document: Document) => void;\r\n}\r\n\r\nconst formatFileSize = (bytes: number) => {\r\n  if (bytes < 1024) return `${bytes} B`;\r\n  if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\r\n  return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\r\n};\r\n\r\nconst formatDate = (date: Date) => {\r\n  return new Date(date).toLocaleDateString('en-US', {\r\n    year: 'numeric',\r\n    month: 'short',\r\n    day: 'numeric'\r\n  });\r\n};\r\n\r\n/**\r\n * Memoized document list item component\r\n * Requirements: 12.1, 12.3 - Performance optimization with React.memo\r\n */\r\nconst DocumentListItem = memo(function DocumentListItem({\r\n  document: doc,\r\n  onPreview,\r\n  onMove,\r\n  onDelete,\r\n}: DocumentListItemProps) {\r\n  const handlePreview = useCallback(() => onPreview(doc), [doc, onPreview]);\r\n  const handleMove = useCallback(() => onMove(doc), [doc, onMove]);\r\n  const handleDelete = useCallback(() => onDelete(doc), [doc, onDelete]);\r\n\r\n  return (\r\n    <tr className=\"hover:bg-gray-50\">\r\n      <td className=\"whitespace-nowrap px-6 py-4\">\r\n        <button\r\n          onClick={handlePreview}\r\n          className=\"flex items-center gap-3 text-left\"\r\n        >\r\n          <svg className=\"h-8 w-8 text-red-500\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n            <path fillRule=\"evenodd\" d=\"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z\" clipRule=\"evenodd\" />\r\n          </svg>\r\n          <div>\r\n            <p className=\"font-medium text-gray-900 hover:text-blue-600\">{doc.name}</p>\r\n            <p className=\"text-xs text-gray-500\">{doc.original_name}</p>\r\n          </div>\r\n        </button>\r\n      </td>\r\n      <td className=\"hidden whitespace-nowrap px-6 py-4 text-sm text-gray-500 sm:table-cell\">\r\n        {formatFileSize(doc.file_size)}\r\n      </td>\r\n      <td className=\"hidden whitespace-nowrap px-6 py-4 text-sm text-gray-500 md:table-cell\">\r\n        {formatDate(doc.created_at)}\r\n      </td>\r\n      <td className=\"whitespace-nowrap px-6 py-4 text-right\">\r\n        <div className=\"flex items-center justify-end gap-2\">\r\n          <button\r\n            onClick={handlePreview}\r\n            className=\"rounded p-1 text-gray-600 hover:bg-gray-100 hover:text-blue-600\"\r\n            title=\"Preview\"\r\n          >\r\n            <svg className=\"h-5 w-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" />\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\" />\r\n            </svg>\r\n          </button>\r\n          <button\r\n            onClick={handleMove}\r\n            className=\"rounded p-1 text-gray-600 hover:bg-gray-100 hover:text-blue-600\"\r\n            title=\"Move\"\r\n          >\r\n            <svg className=\"h-5 w-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4\" />\r\n            </svg>\r\n          </button>\r\n          <button\r\n            onClick={handleDelete}\r\n            className=\"rounded p-1 text-red-600 hover:bg-red-50 hover:text-red-800\"\r\n            title=\"Delete\"\r\n          >\r\n            <svg className=\"h-5 w-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\r\n            </svg>\r\n          </button>\r\n        </div>\r\n      </td>\r\n    </tr>\r\n  );\r\n});\r\n\r\n/**\r\n * Memoized document list component\r\n * Requirements: 12.1, 12.3 - Performance optimization with React.memo\r\n */\r\nexport const DocumentList = memo(function DocumentList({ \r\n  documents, \r\n  onPreview, \r\n  onMove, \r\n  onDelete \r\n}: DocumentListProps) {\r\n\r\n  return (\r\n    <div className=\"overflow-hidden rounded-lg border border-gray-200 bg-white\">\r\n      <table className=\"min-w-full divide-y divide-gray-200\">\r\n        <thead className=\"bg-gray-50\">\r\n          <tr>\r\n            <th className=\"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500\">\r\n              Name\r\n            </th>\r\n            <th className=\"hidden px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500 sm:table-cell\">\r\n              Size\r\n            </th>\r\n            <th className=\"hidden px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500 md:table-cell\">\r\n              Uploaded\r\n            </th>\r\n            <th className=\"px-6 py-3 text-right text-xs font-medium uppercase tracking-wider text-gray-500\">\r\n              Actions\r\n            </th>\r\n          </tr>\r\n        </thead>\r\n        <tbody className=\"divide-y divide-gray-200\">\r\n          {documents.map(doc => (\r\n            <DocumentListItem\r\n              key={doc.id}\r\n              document={doc}\r\n              onPreview={onPreview}\r\n              onMove={onMove}\r\n              onDelete={onDelete}\r\n            />\r\n          ))}\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n  );\r\n});\r\n","\"use client\";\r\n\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport { Document } from '@/lib/db/types';\r\nimport { useAuth } from '@/lib/firebase/AuthContext';\r\n\r\ninterface DocumentPreviewProps {\r\n  document: Document;\r\n  onClose: () => void;\r\n}\r\n\r\nexport function DocumentPreview({ document, onClose }: DocumentPreviewProps) {\r\n  const { user } = useAuth();\r\n  const [presignedUrl, setPresignedUrl] = useState<string | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const fetchPresignedUrl = useCallback(async () => {\r\n    if (!user) return;\r\n    \r\n    setLoading(true);\r\n    setError(null);\r\n    \r\n    try {\r\n      const { getIdToken } = await import('@/lib/hooks/useAuthenticatedFetch');\r\n      const token = await getIdToken();\r\n      if (!token) {\r\n        throw new Error('Not authenticated');\r\n      }\r\n      \r\n      const response = await fetch(`/api/documents/${document.id}`, {\r\n        headers: { 'Authorization': `Bearer ${token}` }\r\n      });\r\n      const data = await response.json();\r\n      \r\n      if (!response.ok) {\r\n        throw new Error(data.error || 'Failed to load document');\r\n      }\r\n      \r\n      setPresignedUrl(data.presignedUrl);\r\n    } catch (err) {\r\n      const message = err instanceof Error ? err.message : 'Failed to load document';\r\n      setError(message);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [document.id, user]);\r\n\r\n  useEffect(() => {\r\n    fetchPresignedUrl();\r\n  }, [fetchPresignedUrl]);\r\n\r\n  // Handle escape key to close\r\n  useEffect(() => {\r\n    const handleEscape = (e: KeyboardEvent) => {\r\n      if (e.key === 'Escape') {\r\n        onClose();\r\n      }\r\n    };\r\n    window.addEventListener('keydown', handleEscape);\r\n    return () => window.removeEventListener('keydown', handleEscape);\r\n  }, [onClose]);\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex flex-col bg-black/90\">\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between bg-gray-900 px-4 py-3\">\r\n        <div className=\"flex items-center gap-3\">\r\n          <svg className=\"h-6 w-6 text-red-500\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n            <path fillRule=\"evenodd\" d=\"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z\" clipRule=\"evenodd\" />\r\n          </svg>\r\n          <div>\r\n            <h2 className=\"text-lg font-medium text-white\">{document.name}</h2>\r\n            <p className=\"text-sm text-gray-400\">{document.original_name}</p>\r\n          </div>\r\n        </div>\r\n        \r\n        <div className=\"flex items-center gap-2\">\r\n          {/* Download button */}\r\n          {presignedUrl && (\r\n            <a\r\n              href={presignedUrl}\r\n              target=\"_blank\"\r\n              rel=\"noopener noreferrer\"\r\n              className=\"flex items-center gap-2 rounded-lg bg-blue-600 px-3 py-2 text-sm font-medium text-white hover:bg-blue-700\"\r\n            >\r\n              <svg className=\"h-4 w-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4\" />\r\n              </svg>\r\n              Download\r\n            </a>\r\n          )}\r\n          \r\n          {/* Close button */}\r\n          <button\r\n            onClick={onClose}\r\n            className=\"rounded-lg p-2 text-gray-400 hover:bg-gray-800 hover:text-white\"\r\n          >\r\n            <svg className=\"h-6 w-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n            </svg>\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Content */}\r\n      <div className=\"flex-1 overflow-hidden\">\r\n        {loading && (\r\n          <div className=\"flex h-full items-center justify-center\">\r\n            <div className=\"flex flex-col items-center gap-4\">\r\n              <div className=\"h-12 w-12 animate-spin rounded-full border-4 border-blue-600 border-t-transparent\" />\r\n              <p className=\"text-gray-400\">Loading document...</p>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {error && (\r\n          <div className=\"flex h-full items-center justify-center\">\r\n            <div className=\"flex flex-col items-center gap-4 text-center\">\r\n              <svg className=\"h-16 w-16 text-red-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" />\r\n              </svg>\r\n              <p className=\"text-lg text-white\">{error}</p>\r\n              <button\r\n                onClick={fetchPresignedUrl}\r\n                className=\"rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700\"\r\n              >\r\n                Try Again\r\n              </button>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {!loading && !error && presignedUrl && (\r\n          <iframe\r\n            src={presignedUrl}\r\n            className=\"h-full w-full\"\r\n            title={`Preview of ${document.name}`}\r\n          />\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","\"use client\";\r\n\r\nimport { useState, useCallback, useEffect } from 'react';\r\nimport { Document } from '@/lib/db/types';\r\nimport { Folder } from '@/lib/hooks/useFolders';\r\n\r\ninterface MoveDocumentModalProps {\r\n  document: Document;\r\n  folders: Folder[];\r\n  onMove: (documentId: string, folderId: string | null) => Promise<void>;\r\n  onClose: () => void;\r\n}\r\n\r\nexport function MoveDocumentModal({\r\n  document,\r\n  folders,\r\n  onMove,\r\n  onClose\r\n}: MoveDocumentModalProps) {\r\n  const [selectedFolderId, setSelectedFolderId] = useState<string | null>(document.folder_id);\r\n  const [expandedFolders, setExpandedFolders] = useState<Set<string>>(new Set());\r\n  const [isMoving, setIsMoving] = useState(false);\r\n\r\n  const toggleExpand = useCallback((folderId: string) => {\r\n    setExpandedFolders(prev => {\r\n      const newSet = new Set(prev);\r\n      if (newSet.has(folderId)) {\r\n        newSet.delete(folderId);\r\n      } else {\r\n        newSet.add(folderId);\r\n      }\r\n      return newSet;\r\n    });\r\n  }, []);\r\n\r\n  // Handle escape key\r\n  useEffect(() => {\r\n    const handleEscape = (e: KeyboardEvent) => {\r\n      if (e.key === 'Escape' && !isMoving) {\r\n        onClose();\r\n      }\r\n    };\r\n    window.addEventListener('keydown', handleEscape);\r\n    return () => window.removeEventListener('keydown', handleEscape);\r\n  }, [onClose, isMoving]);\r\n\r\n  const handleMove = async () => {\r\n    if (selectedFolderId === document.folder_id) {\r\n      onClose();\r\n      return;\r\n    }\r\n    \r\n    setIsMoving(true);\r\n    try {\r\n      await onMove(document.id, selectedFolderId);\r\n      onClose();\r\n    } finally {\r\n      setIsMoving(false);\r\n    }\r\n  };\r\n\r\n  // Build folder tree structure\r\n  const rootFolders = folders.filter(f => f.parent_id === null);\r\n  \r\n  const getChildFolders = (parentId: string) => \r\n    folders.filter(f => f.parent_id === parentId);\r\n\r\n  const renderFolder = (folder: Folder, level: number = 0) => {\r\n    const children = getChildFolders(folder.id);\r\n    const hasChildren = children.length > 0;\r\n    const isExpanded = expandedFolders.has(folder.id);\r\n    const isSelected = folder.id === selectedFolderId;\r\n    const isCurrent = folder.id === document.folder_id;\r\n\r\n    return (\r\n      <div key={folder.id}>\r\n        <div\r\n          className={`\r\n            flex items-center gap-2 rounded-lg px-3 py-2 cursor-pointer transition-colors\r\n            ${isSelected ? 'bg-blue-100 text-blue-900' : 'hover:bg-gray-100'}\r\n            ${isCurrent ? 'border-l-2 border-blue-500' : ''}\r\n          `}\r\n          style={{ paddingLeft: `${level * 20 + 12}px` }}\r\n        >\r\n          {hasChildren ? (\r\n            <button\r\n              onClick={(e) => {\r\n                e.stopPropagation();\r\n                toggleExpand(folder.id);\r\n              }}\r\n              className=\"p-0.5 hover:bg-gray-200 rounded\"\r\n            >\r\n              <svg\r\n                className={`h-4 w-4 text-gray-500 transition-transform ${isExpanded ? 'rotate-90' : ''}`}\r\n                fill=\"none\"\r\n                stroke=\"currentColor\"\r\n                viewBox=\"0 0 24 24\"\r\n              >\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5l7 7-7 7\" />\r\n              </svg>\r\n            </button>\r\n          ) : (\r\n            <span className=\"w-5\" />\r\n          )}\r\n          \r\n          <button\r\n            onClick={() => setSelectedFolderId(folder.id)}\r\n            className=\"flex items-center gap-2 flex-1 text-left\"\r\n          >\r\n            <svg\r\n              className={`h-5 w-5 ${isSelected ? 'text-blue-600' : 'text-yellow-500'}`}\r\n              fill=\"currentColor\"\r\n              viewBox=\"0 0 20 20\"\r\n            >\r\n              <path d=\"M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z\" />\r\n            </svg>\r\n            <span className=\"text-sm font-medium\">{folder.name}</span>\r\n            {isCurrent && (\r\n              <span className=\"text-xs text-gray-500\">(current)</span>\r\n            )}\r\n          </button>\r\n        </div>\r\n        \r\n        {hasChildren && isExpanded && (\r\n          <div>\r\n            {children.map(child => renderFolder(child, level + 1))}\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50\">\r\n      <div className=\"w-full max-w-md rounded-lg bg-white shadow-xl\">\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between border-b border-gray-200 px-4 py-3\">\r\n          <div>\r\n            <h3 className=\"text-lg font-semibold text-gray-900\">Move Document</h3>\r\n            <p className=\"text-sm text-gray-500 truncate max-w-xs\">{document.name}</p>\r\n          </div>\r\n          <button\r\n            onClick={onClose}\r\n            disabled={isMoving}\r\n            className=\"rounded-lg p-1 text-gray-400 hover:bg-gray-100 hover:text-gray-600 disabled:opacity-50\"\r\n          >\r\n            <svg className=\"h-5 w-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n            </svg>\r\n          </button>\r\n        </div>\r\n\r\n        {/* Folder List */}\r\n        <div className=\"max-h-80 overflow-y-auto p-2\">\r\n          {/* Root option */}\r\n          <button\r\n            onClick={() => setSelectedFolderId(null)}\r\n            className={`\r\n              flex w-full items-center gap-2 rounded-lg px-3 py-2 text-left transition-colors\r\n              ${selectedFolderId === null ? 'bg-blue-100 text-blue-900' : 'hover:bg-gray-100'}\r\n              ${document.folder_id === null ? 'border-l-2 border-blue-500' : ''}\r\n            `}\r\n          >\r\n            <svg\r\n              className={`h-5 w-5 ${selectedFolderId === null ? 'text-blue-600' : 'text-gray-400'}`}\r\n              fill=\"none\"\r\n              stroke=\"currentColor\"\r\n              viewBox=\"0 0 24 24\"\r\n            >\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6\" />\r\n            </svg>\r\n            <span className=\"text-sm font-medium\">Root (No folder)</span>\r\n            {document.folder_id === null && (\r\n              <span className=\"text-xs text-gray-500\">(current)</span>\r\n            )}\r\n          </button>\r\n\r\n          {/* Folder tree */}\r\n          {rootFolders.length > 0 ? (\r\n            rootFolders.map(folder => renderFolder(folder))\r\n          ) : (\r\n            <div className=\"py-8 text-center text-sm text-gray-500\">\r\n              No folders available\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Footer */}\r\n        <div className=\"flex justify-end gap-3 border-t border-gray-200 px-4 py-3\">\r\n          <button\r\n            onClick={onClose}\r\n            disabled={isMoving}\r\n            className=\"rounded-lg px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 disabled:opacity-50\"\r\n          >\r\n            Cancel\r\n          </button>\r\n          <button\r\n            onClick={handleMove}\r\n            disabled={isMoving || selectedFolderId === document.folder_id}\r\n            className=\"rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 disabled:opacity-50\"\r\n          >\r\n            {isMoving ? 'Moving...' : 'Move'}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","\"use client\";\r\n\r\nimport { memo, useCallback } from 'react';\r\n\r\nexport type ViewMode = 'grid' | 'list';\r\n\r\ninterface ViewToggleProps {\r\n  viewMode: ViewMode;\r\n  onViewModeChange: (mode: ViewMode) => void;\r\n}\r\n\r\n/**\r\n * Memoized view toggle component\r\n * Requirements: 12.1, 12.3 - Performance optimization with React.memo\r\n * Accessibility: ARIA labels and role for toggle group\r\n */\r\nexport const ViewToggle = memo(function ViewToggle({ viewMode, onViewModeChange }: ViewToggleProps) {\r\n  const handleGridClick = useCallback(() => onViewModeChange('grid'), [onViewModeChange]);\r\n  const handleListClick = useCallback(() => onViewModeChange('list'), [onViewModeChange]);\r\n  return (\r\n    <div \r\n      className=\"flex items-center rounded-lg border border-gray-300 bg-white p-1\"\r\n      role=\"group\"\r\n      aria-label=\"View mode selection\"\r\n    >\r\n      <button\r\n        onClick={handleGridClick}\r\n        className={`\r\n          flex items-center gap-1 rounded-md px-3 py-1.5 text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-1\r\n          ${viewMode === 'grid' \r\n            ? 'bg-blue-100 text-blue-700' \r\n            : 'text-gray-600 hover:bg-gray-100'\r\n          }\r\n        `}\r\n        aria-label=\"Grid view\"\r\n        aria-pressed={viewMode === 'grid'}\r\n      >\r\n        <svg className=\"h-4 w-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\r\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z\" />\r\n        </svg>\r\n        <span className=\"hidden sm:inline\">Grid</span>\r\n      </button>\r\n      <button\r\n        onClick={handleListClick}\r\n        className={`\r\n          flex items-center gap-1 rounded-md px-3 py-1.5 text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-1\r\n          ${viewMode === 'list' \r\n            ? 'bg-blue-100 text-blue-700' \r\n            : 'text-gray-600 hover:bg-gray-100'\r\n          }\r\n        `}\r\n        aria-label=\"List view\"\r\n        aria-pressed={viewMode === 'list'}\r\n      >\r\n        <svg className=\"h-4 w-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\r\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 6h16M4 10h16M4 14h16M4 18h16\" />\r\n        </svg>\r\n        <span className=\"hidden sm:inline\">List</span>\r\n      </button>\r\n    </div>\r\n  );\r\n});\r\n"],"names":[],"mappings":"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"}